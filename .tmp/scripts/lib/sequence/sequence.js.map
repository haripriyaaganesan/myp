{"version":3,"sources":["lib/sequence/sequence.js"],"names":["defineSequence","imagesLoaded","Hammer","instances","instance","Sequence","element","options","instanceId","getAttribute","setAttribute","defaults","startingStepId","startingStepAnimatesIn","cycle","phaseThreshold","reverseWhenNavigatingBackwards","reverseTimingFunctionWhenNavigatingBackwards","moveActiveStepToTop","animateCanvas","animateCanvasDuration","autoPlay","autoPlayInterval","autoPlayDelay","autoPlayDirection","autoPlayButton","autoPlayPauseOnHover","navigationSkip","navigationSkipThreshold","fadeStepWhenSkipped","fadeStepTime","ignorePhaseThresholdWhenSkipped","preventReverseSkipping","nextButton","prevButton","pagination","preloader","preloadTheseSteps","preloadTheseImages","hideStepsUntilPreloaded","pausePreloader","keyNavigation","numericKeysGoToSteps","keyEvents","left","sequence","prev","right","next","swipeNavigation","swipeEvents","up","undefined","down","swipeHammerOptions","hashTags","hashDataAttribute","hashChangesOnFirstStep","fallback","speed","autoPlayDefault","domThreshold","resizeThreshold","prefixTranslations","animation","Modernizr","a","b","c","z","i","cssText","A","l","join","B","C","indexOf","D","d","e","E","f","bind","F","charAt","toUpperCase","slice","n","split","o","documentElement","g","h","createElement","style","j","k","toString","m","toLowerCase","p","svg","q","r","s","t","u","v","w","body","parseInt","id","appendChild","innerHTML","background","overflow","parentNode","removeChild","x","hasOwnProperty","y","call","constructor","prototype","Function","TypeError","arguments","apply","concat","Object","touch","DocumentTouch","offsetTop","cssanimations","csstransforms","csstransitions","createElementNS","createSVGRect","G","push","addTest","enableClasses","className","_version","_prefixes","_domPrefixes","_cssomPrefixes","testProp","testAllProps","testStyles","prefixed","window","document","Array","searchElement","fromIndex","length","Math","abs","Infinity","hidden","visibilityChange","mozHidden","msHidden","webkitHidden","isArray","object","extend","getStyle","property","value","currentStyle","defaultView","getComputedStyle","addEvent","eventName","handler","addEventListener","attachEvent","handlerr","removeEvent","removeEventListener","detachEvent","convertTimeToMs","time","convertedTime","fraction","parseFloat","replace","hasClass","name","RegExp","test","addClass","elements","elementsLength","removeClass","insideElement","cursor","rect","getBoundingClientRect","inside","clientX","clientY","top","bottom","hasParent","parent","target","previousTarget","nodeName","topLevel","allTopLevel","getElementsByTagName","getHammerDirection","swipeDirections","hammerDirection","DIRECTION_NONE","DIRECTION_HORIZONTAL","DIRECTION_VERTICAL","DIRECTION_ALL","addFeatureSupportClasses","$el","prefix","support","self","modernizr","ui","defaultElements","getElements","type","option","relatedElements","rel","querySelectorAll","$container","show","duration","propertySupport","transitions","opacity","animationFallback","animate","hide","callback","hideTimer","setTimeout","init","isAutoPlayPaused","isAutoPlaying","getDelay","delay","startDelay","start","continuing","isReady","started","$autoPlay","isAnimating","autoPlayTimer","stop","clearTimeout","stopped","unpause","pause","canvas","$screen","height","width","getTransformProperties","getSteps","steps","stepId","step","stepElements","children","stepsLength","stepProperties","isActive","canvasTransform","noOfSteps","$steps","seqX","offsetLeft","seqY","move","transforms","firstRun","isFallbackMode","$canvas","seqZ","removeNoJsClass","resetInheritedSpeed","getPhaseProperties","stepElement","stepAnimatedChildren","stepChildren","stepChildrenLength","el","watchedDurations","watchedDelays","watchedLengths","durations","delays","lengths","maxDuration","max","maxDelay","maxTotal","watchedMaxDuration","watchedMaxDelay","watchedMaxTotal","animatedChildren","watchedTimings","timings","getPhaseThreshold","ignorePhaseThreshold","phaseThresholdOption","currentPhaseDuration","phaseThresholdTime","getReversePhaseDelay","currentPhaseTotal","nextPhaseTotal","ignorePhaseThresholdWhenSkippedOption","phaseDifference","current","currentElement","nextElement","prevStepElement","prevStepId","lastStepId","zIndex","manageNavigationSkip","nextStepElement","phaseSkipped","navigationSkipThresholdActive","phasesAnimating","phaseThresholdTimer","nextPhaseStartedTimer","phasesSkipped","stepSkipped","navigationSkipThresholdTimer","changeStep","stepToAdd","currentStepId","stepToRemove","reverseProperties","phaseProperties","phaseDelay","phaseElements","noOfPhaseElements","stepDurations","timingFunction","timingFunctionReversed","total","maxWatchedTotal","totals","watchedTotals","reverseTimingFunction","domDelay","forward","currentStepElement","hashTagNav","currentPhaseProperties","currentPhaseStarted","startAnimateOut","startAnimateIn","reverse","currentId","reversePhaseDelay","nextPhaseProperties","stepDuration","update","nextPhaseStarted","phaseEnded","nextPhaseEnded","getStepDuration","stepEndedTimer","stepEnded","direction","currentPhaseEnded","phase","phaseDuration","currentPhaseEndedTimer","nextPhaseEndedTimer","animationEnded","reversePhase","timingFunctionToCubicBezier","cubicBezier","cubicBezierLength","reversedCubicBezier","numberOfStepElements","getDirection","definedDirection","reverseWhenNavigatingBackwardsOption","cycleOption","requiresFallbackMode","getPropertySupport","properties","animations","unit","from","to","Date","getTime","timer","setInterval","min","clearInterval","setupCanvas","canvasWidth","offsetWidth","position","whiteSpace","moveCanvas","currentFrom","currentTo","nextFrom","nextTo","goTo","currentStep","nextStep","animationStarted","getLinks","childElement","childElements","childNodes","childElementsLength","paginationLinks","nodeType","$pagination","currentPaginationLink","currentPaginationLinksLength","paginationLength","currentLinks","links","correspondingStepId","newHashTag","hasPushstate","history","pushState","location","hash","stepHashTags","getStepHashTags","currentHashTag","hasCorrespondingStep","hashTag","correspondingStep","elementHashTag","hashTagId","currentHashtag","setupEvent","addHashChange","func","before","removeHashChange","hashChangeFuncs","oldHref","href","splice","newHref","_oldHref","preload","defaultHtml","fallbackHtml","defaultStyles","stepImagesToPreload","individualImagesToPreload","imagesToPreload","imgLoad","progress","result","$preloader","append","addStyles","toggleStepsVisibility","getImagesToPreload","on","complete","image","isLoaded","preloadProgress","img","src","preloaded","preloadIndicatorTimer","display","head","styleElement","styleSheet","createTextNode","preloadIndicator","firstChild","indicatorFlash","visibility","preloadFlashTime","removeStyles","srcOnly","elementLength","imagesInStep","imagesInStepLength","Image","insertBefore","manageEvents","list","add","hashChange","hammerTime","resizeThrottle","pageVisibility","$next","button","$prev","toggleAutoPlay","stopOnHover","relatedElementId","removeAll","eventList","eventType","theEvents","remove","eventElements","eventElementsLength","hammer","off","eventProperties","newURL","hashchange","targetElement","buttonEvent","event","preventDefault","returnValue","srcElement","click","previouslyInside","touchHandler","isMouseOver","isTouched","touchstart","mousemove","mouseleave","get","set","keyCodeChar","String","fromCharCode","keyCode","keyup","throttledEvents","throttledResize","throttleTimer","resize","prevStep","transformProperties","goToFirstStep","ready","destroy","lastStep","fadeStepTimer","removeAttribute","destroyed","nextStepId","utils","define","amd"],"mappings":"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","file":"sequence.js","sourcesContent":["/*\n * Sequence.js\n *\n * The responsive CSS animation framework for creating unique sliders,\n * presentations, banners, and other step-based applications.\n *\n * @link https://github.com/IanLunn/Sequence\n * @author IanLunn\n * @version 2.1.0\n * @license http://sequencejs.com/licenses/\n * @copyright Ian Lunn Design Limited 2015\n */\n\nfunction defineSequence(imagesLoaded, Hammer) {\n\n  'use strict';\n\n  var instances = [],\n      instance = 0;\n\n  /**\n   * Sequence function\n   *\n   * @param {Object} element - the element Sequence is bound to\n   * @param {Object} options - this instance's options\n   * @returns {Object} self - Properties and methods available to this instance\n   */\n  var Sequence = (function (element, options) {\n\n    var instanceId = element.getAttribute(\"data-seq-enabled\");\n\n    // Prevent multiple instances on the same element. Return the object instead\n    if (instanceId !== null) {\n      return instances[instanceId];\n    }\n\n    // The element now has Sequence attached to it\n    element.setAttribute(\"data-seq-enabled\", instance);\n    instance++;\n\n    /* --- PRIVATE VARIABLES/FUNCTIONS --- */\n\n    // Default Sequence settings\n    var defaults = {\n\n      /* --- General --- */\n\n      // The first step to show\n      startingStepId: 1,\n\n      // Should the starting step animate in to begin with?\n      startingStepAnimatesIn: false,\n\n      // When the last step is reached, should Sequence cycle back to the start?\n      cycle: true,\n\n      // How long to wait between the current phase animating out, and the next\n      // animating in.\n      phaseThreshold: true,\n\n      // Should transitions be reversed when navigating backwards?\n      reverseWhenNavigatingBackwards: false,\n\n      // Should transition-timing-function be reversed when navigating backwards?\n      reverseTimingFunctionWhenNavigatingBackwards: false,\n\n      // Should the active step be given a higher z-index?\n      moveActiveStepToTop: true,\n\n\n      /* --- Canvas Animation --- */\n\n      // Should the canvas automatically animate between steps?\n      animateCanvas: true,\n\n      // Time it should take to animate between steps\n      animateCanvasDuration: 250,\n\n\n      /* --- autoPlay --- */\n\n      // Cause Sequence to automatically navigate between steps\n      // Specify a number in milliseconds or true (for a default of 5000ms) to\n      // define the period Sequence should wait between each step before\n      // navigating to the next step\n      autoPlay: false,\n\n      // How long to wait between each step before navigation occurs again\n      autoPlayInterval: 5000,\n\n      // Amount of time to wait until autoPlay starts again after being stopped\n      autoPlayDelay: null,\n\n      // Direction of navigation when autoPlay is enabled\n      autoPlayDirection: 1,\n\n      // Use an autoPlay button? You can also specify a CSS selector to\n      // change what element acts as the button. If true, the element uses the\n      // class of \"seq-autoplay\"\n      autoPlayButton: true,\n\n      // Pause autoPlay when the Sequence element is hovered over\n      autoPlayPauseOnHover: true,\n\n\n      /* --- Navigation Skipping --- */\n\n      // Allow the user to navigate between steps even if they haven't\n      // finished animating\n      navigationSkip: true,\n\n      // How long to wait before the user is allowed to skip to another step\n      navigationSkipThreshold: 250,\n\n      // Fade a step when it has been skipped\n      fadeStepWhenSkipped: true,\n\n      // How long the fade should take\n      fadeStepTime: 500,\n\n      // When a step is skipped, the next step will immediately animate-in\n      // regardless of the phaseThreshold option\n      ignorePhaseThresholdWhenSkipped: false,\n\n      // Don't allow the user to go to a previous step when the current one is\n      // still active\n      preventReverseSkipping: false,\n\n\n      /* --- Next/Prev Button --- */\n\n      // Use next and previous buttons? You can also specify a CSS selector to\n      // change what element acts as the button. If true, the element uses\n      // classes of \"seq-next\" and \"seq-prev\"\n      nextButton: true,\n      prevButton: true,\n\n\n      /* --- Pagination --- */\n\n      // Use pagination? You can also specify a CSS selector to\n      // change what element acts as pagination. If true, the element uses the\n      // class of \"seq-pagination\"\n      pagination: true,\n\n\n      /* --- Preloader --- */\n\n      // You can also specify a CSS selector to\n      // change what element acts as the preloader. If true, the element uses\n      // the class of \"seq-preloader\"\n      preloader: false,\n\n      // Preload all images from specific steps\n      preloadTheseSteps: [1],\n\n      // Preload specified images\n      preloadTheseImages: [\n        /**\n         * Example usage\n         * \"images/catEatingSalad.jpg\",\n         * \"images/grandmaDressedAsBatman.png\"\n         */\n      ],\n\n      // Hide Sequence's steps until it has preloaded\n      hideStepsUntilPreloaded: false,\n\n      // (Debugging only) Prevent the preloader from hiding so you can\n      // test it's styles\n      pausePreloader: false,\n\n\n      /* --- Keyboard --- */\n\n      // Can the user navigate between steps by pressing keyboard buttons?\n      keyNavigation: false,\n\n      // When numeric keys 1 - 9 are pressed, Sequence will navigate to the\n      // corresponding step\n      numericKeysGoToSteps: false,\n\n      // Events to run when the user presses the left/right keys\n      keyEvents: {\n        left: function(sequence) {sequence.prev();},\n        right: function(sequence) {sequence.next();}\n      },\n\n\n      /* --- Touch Swipe --- */\n\n      // Can the user navigate between steps by swiping on a touch enabled device?\n      swipeNavigation: true,\n\n      // Events to run when the user swipes in a particular direction\n      swipeEvents: {\n        left: function(sequence) {sequence.next();},\n        right: function(sequence) {sequence.prev();},\n        up: undefined,\n        down: undefined\n      },\n\n      // Options to supply the third-party Hammer library See: http://hammerjs.github.io/recognizer-swipe/\n      swipeHammerOptions: {},\n\n\n      /* --- hashTags --- */\n\n      // Should the URL update to include a hashTag that relates to the current\n      // step being shown?\n      hashTags: false,\n\n      // Get the hashTag from an ID or data-seq-hashtag attribute?\n      hashDataAttribute: false,\n\n      // Should the hash change on the first step?\n      hashChangesOnFirstStep: false,\n\n\n      /* --- Fallback Theme --- */\n\n      // Settings to use when the browser doesn't support CSS transitions\n      fallback: {\n\n        // The speed to transition between steps\n        speed: 500\n      }\n    };\n\n    // Default value for autoPlay in milliseconds\n    var autoPlayDefault = 5000;\n\n    // See sequence.animation.domDelay() for an explanation of this\n    var domThreshold = 50;\n\n    // Throttle the window resize event\n    // see self.manageEvents.add.resizeThrottle()\n    var resizeThreshold = 100;\n\n    // Convert browser fixes to CSS strings\n    var prefixTranslations = {\n\n      animation: {\n        \"WebkitAnimation\": \"-webkit-\",\n        \"animation\": \"\"\n      }\n    };\n\n    /**\n     *\n     * This version of Modernizr is for use with Sequence.js and is included\n     * internally to prevent conflicts with other Modernizr builds.\n     *\n     * Modernizr 2.8.3 (Custom Build) | MIT & BSD\n     * Build: http://modernizr.com/download/#-cssanimations-csstransforms-csstransitions-svg-touch-prefixed-teststyles-testprop-testallprops-prefixes-domprefixes\n     */\n\n    /* jshint ignore:start */\n    var Modernizr=function(a,b,c){function z(a){i.cssText=a}function A(a,b){return z(l.join(a+\";\")+(b||\"\"))}function B(a,b){return typeof a===b}function C(a,b){return!!~(\"\"+a).indexOf(b)}function D(a,b){for(var d in a){var e=a[d];if(!C(e,\"-\")&&i[e]!==c)return b==\"pfx\"?e:!0}return!1}function E(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:B(f,\"function\")?f.bind(d||b):f}return!1}function F(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+\" \"+n.join(d+\" \")+d).split(\" \");return B(b,\"string\")||B(b,\"undefined\")?D(e,b):(e=(a+\" \"+o.join(d+\" \")+d).split(\" \"),E(e,b,c))}var d=\"2.8.3\",e={},f=b.documentElement,g=\"modernizr\",h=b.createElement(g),i=h.style,j,k={}.toString,l=\" -webkit- -moz- -o- -ms- \".split(\" \"),m=\"Webkit Moz O ms\",n=m.split(\" \"),o=m.toLowerCase().split(\" \"),p={svg:\"http://www.w3.org/2000/svg\"},q={},r={},s={},t=[],u=t.slice,v,w=function(a,c,d,e){var h,i,j,k,l=b.createElement(\"div\"),m=b.body,n=m||b.createElement(\"body\");if(parseInt(d,10))while(d--)j=b.createElement(\"div\"),j.id=e?e[d]:g+(d+1),l.appendChild(j);return h=[\"&#173;\",'<style id=\"s',g,'\">',a,\"</style>\"].join(\"\"),l.id=g,(m?l:n).innerHTML+=h,n.appendChild(l),m||(n.style.background=\"\",n.style.overflow=\"hidden\",k=f.style.overflow,f.style.overflow=\"hidden\",f.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),f.style.overflow=k),!!i},x={}.hasOwnProperty,y;!B(x,\"undefined\")&&!B(x.call,\"undefined\")?y=function(a,b){return x.call(a,b)}:y=function(a,b){return b in a&&B(a.constructor.prototype[b],\"undefined\")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!=\"function\")throw new TypeError;var d=u.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(u.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(u.call(arguments)))};return e}),q.touch=function(){var c;return\"ontouchstart\"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:w([\"@media (\",l.join(\"touch-enabled),(\"),g,\")\",\"{#modernizr{top:9px;position:absolute}}\"].join(\"\"),function(a){c=a.offsetTop===9}),c},q.cssanimations=function(){return F(\"animationName\")},q.csstransforms=function(){return!!F(\"transform\")},q.csstransitions=function(){return F(\"transition\")},q.svg=function(){return!!b.createElementNS&&!!b.createElementNS(p.svg,\"svg\").createSVGRect};for(var G in q)y(q,G)&&(v=G.toLowerCase(),e[v]=q[G](),t.push((e[v]?\"\":\"no-\")+v));return e.addTest=function(a,b){if(typeof a==\"object\")for(var d in a)y(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b==\"function\"?b():b,typeof enableClasses!=\"undefined\"&&enableClasses&&(f.className+=\" \"+(b?\"\":\"no-\")+a),e[a]=b}return e},z(\"\"),h=j=null,e._version=d,e._prefixes=l,e._domPrefixes=o,e._cssomPrefixes=n,e.testProp=function(a){return D([a])},e.testAllProps=F,e.testStyles=w,e.prefixed=function(a,b,c){return b?F(a,b,c):F(a,\"pfx\")},e}(window,window.document);\n    /* jshint ignore:end */\n\n    // Add indexOf() support to arrays for Internet Explorer 8\n    if (!Array.prototype.indexOf) {\n      Array.prototype.indexOf = function (searchElement, fromIndex) {\n        if ( this === undefined || this === null ) {\n          throw new TypeError( '\"this\" is null or not defined' );\n        }\n\n        // Hack to convert object.length to a UInt32\n        var length = this.length >>> 0;\n\n        fromIndex = +fromIndex || 0;\n\n        if (Math.abs(fromIndex) === Infinity) {\n          fromIndex = 0;\n        }\n\n        if (fromIndex < 0) {\n          fromIndex += length;\n          if (fromIndex < 0) {\n            fromIndex = 0;\n          }\n        }\n\n        for (;fromIndex < length; fromIndex++) {\n          if (this[fromIndex] === searchElement) {\n            return fromIndex;\n          }\n        }\n\n        return -1;\n      };\n    }\n\n    /**\n     * Determine the prefix to use for the pageVisibility API\n     */\n    var hidden,\n        visibilityChange;\n\n    if (typeof document.hidden !== \"undefined\") {\n\n      // Opera 12.10 and Firefox 18 and later support\n      hidden = \"hidden\";\n      visibilityChange = \"visibilitychange\";\n    } else if (typeof document.mozHidden !== \"undefined\") {\n\n      hidden = \"mozHidden\";\n      visibilityChange = \"mozvisibilitychange\";\n    } else if (typeof document.msHidden !== \"undefined\") {\n\n      hidden = \"msHidden\";\n      visibilityChange = \"msvisibilitychange\";\n    } else if (typeof document.webkitHidden !== \"undefined\") {\n\n      hidden = \"webkitHidden\";\n      visibilityChange = \"webkitvisibilitychange\";\n    }\n\n    /**\n     * Is an object an array?\n     *\n     * @param {Object} object - The object we want to test\n     * @api private\n     */\n    function isArray(object) {\n\n      if (Object.prototype.toString.call(object) === '[object Array]') {\n        return true;\n      }else {\n        return false;\n      }\n    }\n\n    /**\n     * Extend object a with the properties of object b.\n     * If there's a conflict, object b takes precedence.\n     *\n     * @param {Object} a - The first object to merge\n     * @param {Object} b - The second object to merge (takes precedence)\n     * @api private\n     */\n    function extend(a, b) {\n\n      for (var i in b) {\n        a[i] = b[i];\n      }\n\n      return a;\n    }\n\n    /**\n     * Get the values of an element's CSS property\n     *\n     * @param {HTMLObject} element - The element to get the value from\n     * @param {String} property - The CSS property to get the value of\n     * @returns {String} value - The value from the element's CSS property\n     */\n    function getStyle(element, property) {\n\n      var value;\n\n      // IE\n      if (element.currentStyle) {\n        value = element.currentStyle[property];\n      }\n\n      else if (document.defaultView && document.defaultView.getComputedStyle) {\n        value = document.defaultView.getComputedStyle(element, \"\")[property];\n      }\n\n      return value;\n    }\n\n    /**\n     * Cross Browser helper for addEventListener\n     *\n     * @param {HTMLObject} element - The element to attach the event to\n     * @param {String} eventName - The name of the event; \"click\" for example\n     * @param {Function} handler - The function to execute when the event occurs\n     * @returns {Function} handler - Returns the handler so it can be removed\n     */\n    function addEvent(element, eventName, handler) {\n\n      if (element.addEventListener) {\n        element.addEventListener(eventName, handler, false);\n\n        return handler;\n      }\n\n      else if (element.attachEvent) {\n\n        // Allows IE to return this keyword\n        var handlerr = function() {\n          handler.call(element);\n        };\n\n        element.attachEvent(\"on\" + eventName, handlerr);\n\n        return handlerr;\n      }\n\n    }\n\n    /**\n     * Cross Browser helper for removeEventListener\n     *\n     * @param {HTMLObject} element - The element to attach the event to\n     * @param {String} eventName - The name of the event; \"click\" for example\n     * @param {Function} handler - The function to execute when the event occurs\n     */\n    function removeEvent(element, eventName, handler) {\n\n      if (element.addEventListener) {\n        element.removeEventListener(eventName, handler, false);\n      }\n\n      else if (element.detachEvent) {\n        element.detachEvent(\"on\" + eventName, handler);\n      }\n    }\n\n    /**\n     * Converts a time value taken from a CSS property, such as \"0.5s\"\n     * and converts it to a number in milliseconds, such as 500\n     *\n     * @param {String} time - the time in a string\n     * @returns {Number} convertedTime - the time as a number\n     * @api private\n     */\n    function convertTimeToMs(time) {\n\n      var convertedTime,\n          fraction;\n\n      // Deal with milliseconds and seconds\n      if (time.indexOf(\"ms\") > -1) {\n        fraction = 1;\n      }else {\n        fraction = 1000;\n      }\n\n      if (time == \"0s\") {\n        convertedTime = 0;\n      }else {\n        convertedTime = parseFloat(time.replace(\"s\", \"\")) * fraction;\n      }\n\n      return convertedTime;\n    }\n\n    /**\n     * Does an element have a particular class?\n     *\n     * @param {HTMLElement} element - The element to check\n     * @param {String} name - The name of the class to check for\n     * @returns {Boolean}\n     * @api private\n     */\n    function hasClass(element, name) {\n\n      if (element === undefined) {\n        return;\n      }\n\n      return new RegExp('(\\\\s|^)' + name + '(\\\\s|$)').test(element.className);\n    }\n\n    /**\n     * Add a class to an element\n     *\n     * @param {Object} elements - The element(s) to add a class to\n     * @param {String} name - The class to add\n     * @api private\n     */\n    function addClass(elements, name) {\n\n      var element,\n          elementsLength,\n          i;\n\n      // If only one element is defined, turn it into a nodelist so it'll pass\n      // through the for loop\n      if (isArray(elements) === false) {\n        elementsLength = 1;\n        elements = [elements];\n      }\n\n      elementsLength = elements.length;\n\n      for (i = 0; i < elementsLength; i++) {\n\n        element = elements[i];\n\n        if (hasClass(element, name) === false) {\n          element.className += (element.className ? ' ': '') + name;\n        }\n      }\n    }\n\n    /**\n     * Remove a class from an element\n     *\n     * @param {Object} elements - The element to remove a class from\n     * @param {String} name - The class to remove\n     * @api private\n     */\n    function removeClass(elements, name) {\n\n      var element,\n          elementsLength,\n          i;\n\n      // If only one element is defined, turn it into a nodelist so it'll pass\n      // through the for loop\n      if (isArray(elements) === false) {\n        elementsLength = 1;\n        elements = [elements];\n      }\n\n      else {\n        elementsLength = elements.length;\n      }\n\n      for (i = 0; i < elementsLength; i++) {\n\n        element = elements[i];\n\n        if (hasClass(element, name) === true) {\n          element.className = element.className.replace(new RegExp('(\\\\s|^)' + name + '(\\\\s|$)'),' ').replace(/^\\s+|\\s+$/g, '');\n        }\n      }\n    }\n\n    /**\n     * Determine if the cursor is inside the boundaries of an\n     * element.\n     *\n     * @param {Object} element - The element to test\n     * @param {Object} cursor - The event holding cursor properties\n     */\n    function insideElement(element, cursor) {\n\n      // Get the elements boundaries\n      var rect = element.getBoundingClientRect(),\n          inside = false;\n\n      // Return true if inside the boundaries of the Sequence element\n      if (cursor.clientX >= rect.left && cursor.clientX <= rect.right && cursor.clientY >= rect.top && cursor.clientY <= rect.bottom) {\n        inside = true;\n      }\n\n      return inside;\n    }\n\n    /**\n     * Determine if an element has a specified parent, and if so, return the\n     * index number for the element.\n     *\n     * The index is taken from the top level elements witint a pagination\n     * element. This function will iterate through each parent until it\n     * reaches the top level, then get all top level elements and determine\n     * the index of the chosen top level.\n     *\n     * @param {Object} parents - The parent element(s) that the child should be\n     * within\n     * @param {Object} target - The child element to test if it has the parent\n     * @param {Object} previousTarget - The element that was previously checked\n     * to determine if it was top level\n     * @api private\n     */\n    function hasParent(parent, target, previousTarget) {\n\n      if (target.nodeName === \"BODY\") {\n        return false;\n      }\n\n      // We're at the pagination parent\n      if (parent === target) {\n\n        if (previousTarget !== undefined) {\n\n          // Get the top level element clicked and all top level elements\n          var topLevel = previousTarget;\n          var allTopLevel = parent.getElementsByTagName(topLevel.nodeName);\n\n          // Count the number of top level elements\n          var i = allTopLevel.length;\n\n          // Which top level element was clicked?\n          while (i--) {\n            if (topLevel === allTopLevel[i]) {\n\n              // One-base the index and return it\n              return i + 1;\n            }\n          }\n        }\n      }\n\n      // Not yet at the pagination parent element, iterate again\n      else {\n        previousTarget = target;\n        return hasParent(parent, target.parentNode, previousTarget);\n      }\n    }\n\n    /**\n     * Determine the Hammer direction required based on the swipe directions\n     * being used\n     * hammerjs.github.io/api/#directions\n     *\n     * @param {Object} swipeEvents - An object holding each swipe direction and\n     * the handler to execute\n     * @api private\n     */\n    function getHammerDirection(swipeEvents) {\n\n      var swipeDirections = 0,\n          hammerDirection = Hammer.DIRECTION_NONE;\n\n      if (swipeEvents.left !== undefined || swipeEvents.right !== undefined) {\n        swipeDirections += 1;\n      }\n\n      if (swipeEvents.up !== undefined || swipeEvents.down !== undefined) {\n        swipeDirections += 2;\n      }\n\n      if (swipeDirections === 1) {\n        hammerDirection = Hammer.DIRECTION_HORIZONTAL;\n      } else if (swipeDirections === 2) {\n        hammerDirection = Hammer.DIRECTION_VERTICAL;\n      } else if (swipeDirections === 3) {\n        hammerDirection = Hammer.DIRECTION_ALL;\n      }\n\n      return hammerDirection;\n    }\n\n    /**\n     * Add classes to the Sequence container that allow for styling based on\n     * feature support.\n     *\n     * @param {HTMLObject} $el - The element to add the classes to\n     * @param {Object} Modernizr - Sequence's instance of Modernizr\n     * @api private\n     */\n    function addFeatureSupportClasses($el, Modernizr) {\n\n      // TODO: Add support for all features used by Sequence and only manipulate\n      // the DOM once. Currently this function just adds a class for the touch\n      // feature. Probably best just to copy how Modernizr does it to implement\n      // full list of features\n\n      var prefix = \"seq-\",\n          support = \"no-touch\";\n\n      if (Modernizr.touch === true) {\n        support = \"touch\";\n      }\n\n      addClass($el, prefix + support);\n    }\n\n    /* --- PUBLIC PROPERTIES/METHODS --- */\n\n    // Expose some of Sequence's private properties\n    var self = {\n      modernizr: Modernizr\n    };\n\n    /**\n     * Manage UI elements such as nextButton, prevButton, and pagination\n     */\n    self.ui = {\n\n      // Default UI elements\n      defaultElements: {\n        \"nextButton\": \"seq-next\",\n        \"prevButton\": \"seq-prev\",\n        \"autoPlayButton\": \"seq-autoplay\",\n        \"pagination\": \"seq-pagination\",\n        \"preloader\": \"seq-preloader\"\n      },\n\n      /**\n       * Get an UI element\n       *\n       * @param {String} type - The type of UI element (nextButton for example)\n       * @returns {Boolean | HTMLElement} option - True if using the default\n       * element, else an HTMLElement\n       */\n      getElements: function(type, option) {\n\n        var element,\n            elements,\n            elementsLength,\n            relatedElements = [],\n            rel,\n            i;\n\n        // Get the element being used\n        if (option === true) {\n\n          // Default elements\n          elements = document.querySelectorAll(\".\" + this.defaultElements[type]);\n        } else {\n\n          // Custom elements\n          elements = document.querySelectorAll(option);\n        }\n\n        elementsLength = elements.length;\n\n        // Does the element control this instance of Sequence? We're looking\n        // for either a global element or one with a rel attribute the same\n        // as this instances ID\n        for (i = 0; i < elementsLength; i++) {\n\n          element = elements[i];\n          rel = element.getAttribute(\"rel\");\n\n          if (rel === null || rel === self.$container.getAttribute(\"id\")) {\n            relatedElements.push(element);\n          }\n        }\n\n        return relatedElements;\n      },\n\n      /**\n       * Fade an element in using transitions if they're supported, else use JS\n       *\n       * @param {HTMLElement} element - The element to show\n       * @param {Number} duration - The duration to show the element over\n       */\n      show: function(element, duration) {\n\n        if (self.propertySupport.transitions === true) {\n\n          element.style[Modernizr.prefixed(\"transitionDuration\")] = duration + \"ms\";\n          element.style[Modernizr.prefixed(\"transitionProperty\")] = \"opacity, \" + Modernizr.prefixed(\"transform\");\n          element.style.opacity = 1;\n        }\n\n        else {\n\n          self.animationFallback.animate(element, \"opacity\", \"\", 0, 1, duration);\n        }\n      },\n\n      /**\n       * Fade an element out using transitions if they're supported, else use JS\n       *\n       * @param {HTMLElement} element - The element to hide\n       * @param {Number} duration - The duration to hide the element over\n       * @param {Function} callback - Function to execute when the element is\n       * hidden\n       */\n      hide: function(element, duration, callback) {\n\n        if (self.propertySupport.transitions === true) {\n\n          element.style[Modernizr.prefixed(\"transitionDuration\")] = duration + \"ms\";\n          element.style[Modernizr.prefixed(\"transitionProperty\")] = \"opacity, \" + Modernizr.prefixed(\"transform\");\n          element.style.opacity = 0;\n        }\n\n        else {\n\n          self.animationFallback.animate(element, \"opacity\", \"\", 1, 0, duration);\n        }\n\n        if (callback !== undefined) {\n          self.hideTimer = setTimeout(function() {\n            callback();\n          }, duration);\n        }\n      }\n    };\n\n    /**\n     * Methods relating to autoPlay\n     */\n    self.autoPlay = {\n\n      /**\n       * Initiate autoPlay\n       */\n      init: function() {\n\n        self.isAutoPlayPaused = false;\n        self.isAutoPlaying = false;\n      },\n\n      /**\n       * Determine the delay that should be applied before starting autoPlay. A\n       * custom delay should take precedence. If delay is true then the delay\n       * should use options.autoPlayDelay where specified. If not\n       * specified, use the same time as defined in options.autoPlayInterval\n       *\n       * @param {Boolean/Number} delay - Whether a delay should be applied before\n       * starting autoPlay (true = same amount as options.autoPlayInterval,\n       * false = no interval, number = custom interval period). Applied to\n       * autoPlay.start()\n       * @param {Number} startDelay - The delay applied via options.autoPlayDelay\n       * @param {Number} autoPlayInterval - The delay applied via options.autoPlayInterval\n       */\n      getDelay: function(delay, startDelay, autoPlayInterval) {\n\n        switch (delay) {\n\n          case true:\n\n            delay = (startDelay === null) ? autoPlayInterval: startDelay;\n            break;\n\n          case false:\n          case undefined:\n            delay = 0;\n            break;\n        }\n\n        return delay;\n      },\n\n      /**\n       * Start autoPlay\n       *\n       * @param {Boolean/Number} delay - Whether a delay should be applied before\n       * starting autoPlay (true = same amount as options.autoPlayInterval,\n       * false = no delay, number = custom delay period)\n       * @param {Boolean} continuing - If autoPlay is continuing from a\n       * previous cycle, the started() callback won't be triggered\n       * @returns false - When autoPlay is already active and can't be started\n       * again\n       */\n      start: function(delay, continuing) {\n\n        // Only start once\n        if (self.isAutoPlaying === true || self.isReady === false) {\n          return false;\n        }\n\n        var options = self.options;\n\n        // Which delay should we use?\n        delay = this.getDelay(delay, options.autoPlayDelay, options.autoPlayInterval);\n\n        // Callback (only to be triggered when autoPlay is continuing from a\n        // previous cycle)\n        if (continuing === undefined) {\n          self.started(self);\n        }\n\n        addClass(self.$container, \"seq-autoplaying\");\n        addClass(self.$autoPlay, \"seq-autoplaying\");\n\n        // autoPlay is now enabled and active\n        options.autoPlay = true;\n        self.isAutoPlaying = true;\n\n        // Only start a new autoPlay timer if Sequence isn't already animating.\n        // If it is, a new one will be started at the end of the animation.\n        if (self.isAnimating === false) {\n\n          // Choose the direction and start autoPlay\n          self.autoPlayTimer = setTimeout(function() {\n\n            if (options.autoPlayDirection === 1) {\n              self.next();\n            }else {\n              self.prev();\n            }\n          }, delay);\n        }\n\n        return true;\n      },\n\n      /**\n       * Stop autoPlay\n       */\n      stop: function() {\n\n        if (self.options.autoPlay === true && self.isAutoPlaying === true) {\n          self.options.autoPlay = false;\n          self.isAutoPlaying = false;\n          clearTimeout(self.autoPlayTimer);\n\n          removeClass(self.$container, \"seq-autoplaying\");\n          removeClass(self.$autoPlay, \"seq-autoplaying\");\n\n          // Callback\n          self.stopped(self);\n        } else {\n          return false;\n        }\n\n        return true;\n      },\n\n      /**\n       * Unpause autoPlay\n       *\n       * autoPlay.pause() and autoPlay.unpause() are used internally to\n       * temporarily stop autoPlay when hovered over.\n       */\n      unpause: function() {\n\n        if (self.isAutoPlayPaused === true) {\n\n          self.isAutoPlayPaused = false;\n          this.start(true);\n        } else {\n          return false;\n        }\n\n        return true;\n      },\n\n      /**\n       * Pause autoPlay\n       *\n       * autoPlay.pause() and autoPlay.unpause() are used internally to\n       * temporarily stop autoPlay when hovered over.\n       */\n      pause: function() {\n\n        if (self.options.autoPlay === true) {\n\n          self.isAutoPlayPaused = true;\n          this.stop();\n\n        } else {\n          return false;\n        }\n\n        return true;\n      }\n    };\n\n    /**\n     * Controls Sequence's canvas\n     */\n    self.canvas = {\n\n      /**\n       * Setup the canvas, screen, and steps ready to be animated\n       */\n      init: function(id) {\n\n        if (self.$screen !== undefined) {\n          self.$screen.style.height = \"100%\";\n          self.$screen.style.width = \"100%\";\n        }\n\n        // Determine the position of each step and the transform properties\n        // required for the canvas so it can move to each step\n        self.canvas.getTransformProperties();\n      },\n\n      /**\n       * Get Sequence's steps\n       *\n       * @param {HTMLElement} canvas - The canvas element\n       * @returns {Array} steps - The elements that make up Sequence's steps\n       * @api private\n       */\n      getSteps: function(canvas) {\n\n        var steps = [],\n            stepId,\n            step,\n            stepElements = canvas.children,\n            stepsLength = stepElements.length,\n            i;\n\n        // Where we'll save info about the animation\n        self.stepProperties = {};\n\n        // Get the steps that have a parent with a class of \"seq-canvas\"\n        for (i = 0; i < stepsLength; i++) {\n\n          step = stepElements[i];\n          stepId = i + 1;\n\n          steps.push(step);\n\n          // Add each step to the animation map, where we'll save its transform\n          // properties\n          self.stepProperties[stepId] = {};\n          self.stepProperties[stepId].isActive = false;\n        }\n\n        return steps;\n      },\n\n      /**\n       * Determine the position of each step and the transform properties\n       * required for the canvas so it can move to each step\n       *\n       */\n      getTransformProperties: function() {\n\n        var i,\n            step,\n            stepId,\n            canvasTransform;\n\n        for (i = 0; i < self.noOfSteps; i++) {\n\n          step = self.$steps[i];\n          stepId = i + 1;\n\n          canvasTransform = {\n            \"seqX\": 0,\n            \"seqY\": 0,\n            \"seqZ\": 0\n          };\n\n          // Invert the steps offsetLeft and offsetTop to the canvas will always\n          // move to show the step\n          canvasTransform.seqX += step.offsetLeft * -1;\n          canvasTransform.seqY += step.offsetTop * -1;\n\n          self.stepProperties[stepId].canvasTransform = canvasTransform;\n        }\n      },\n\n      /**\n       * Move the canvas to show a specific step\n       *\n       * @param {Number} id - The ID of the step to move to\n       * @param {Boolean} animate - Should the canvas animate or snap?\n       */\n      move: function(id, animate) {\n\n        if (self.options.animateCanvas === true) {\n\n          // Get the canvas element and step element to animate to\n          var duration = 0,\n              transforms;\n\n          // Should the canvas animate?\n          if (animate === true && self.firstRun === false) {\n            duration = self.options.animateCanvasDuration;\n          }\n\n          // Animate the canvas using CSS transitions\n          if (self.isFallbackMode === false) {\n\n            transforms = self.stepProperties[id].canvasTransform;\n\n            // Apply the transform CSS to the canvas\n            self.$canvas.style[Modernizr.prefixed(\"transitionDuration\")] = duration + \"ms\";\n            self.$canvas.style[Modernizr.prefixed(\"transform\")] = \"translateX(\" + transforms.seqX + \"px) \" + \"translateY(\" + transforms.seqY + \"px) \" + \"translateZ(\" + transforms.seqZ + \"px) \";\n          }\n\n          return true;\n        }\n\n        return false;\n      },\n\n      /**\n       * Remove the no-JS \"seq-in\" class from a step\n       *\n       * @param {Object} self - Properties and methods available to this instance\n       * @api private\n       */\n      removeNoJsClass: function() {\n\n        if (self.isFallbackMode === true) {\n          return;\n        }\n\n        // Look for the step with the \"seq-in\" class and remove the class\n        for (var i = 0; i < self.$steps.length; i++) {\n          var element = self.$steps[i];\n\n          if (hasClass(element, \"seq-in\") === true) {\n            var step = i + 1;\n\n            self.animation.resetInheritedSpeed(step);\n            removeClass(element, \"seq-in\");\n          }\n        }\n      }\n    };\n\n    /**\n     * Controls Sequence's step animations\n     */\n    self.animation = {\n\n      /**\n       * Get the properties of a phase\n       *\n       * @param {Number} stepId - The ID of the step\n       * @returns {Object} ID and element of the step the phase belongs to,\n       * array of all child elements that belong to step, array of animated\n       * elements, timings object containing maxDuration, maxDelay, and\n       * maxLength\n       */\n      getPhaseProperties: function(stepId) {\n\n        var stepElement = self.$steps[stepId - 1],\n            stepAnimatedChildren = stepElement.querySelectorAll(\"*[data-seq]\"),\n            stepChildren = stepElement.querySelectorAll(\"*\"),\n            stepChildrenLength = stepChildren.length,\n            el,\n            i,\n            watchedDurations = [],\n            watchedDelays = [],\n            watchedLengths = [],\n            durations = [],\n            delays = [],\n            lengths = [],\n            duration,\n            delay;\n\n        // Get the animation length of each element (duration + delay) and save\n        // for comparisson\n        for (i = 0; i < stepChildrenLength; i++) {\n          el = stepChildren[i];\n\n          duration = convertTimeToMs(getStyle(el, Modernizr.prefixed(\"transitionDuration\")));\n          delay = convertTimeToMs(getStyle(el, Modernizr.prefixed(\"transitionDelay\")));\n\n          // Save this elements animation length for all elements\n          durations.push(duration);\n          delays.push(delay);\n          lengths.push(duration + delay);\n\n          // Also save animation lengths but only for watched elements\n          if (el.getAttribute(\"data-seq\") !== null) {\n            watchedDurations.push(duration);\n            watchedDelays.push(delay);\n            watchedLengths.push(duration + delay);\n          }\n        }\n\n        // Which were the longest durations and delays?\n        var maxDuration = Math.max.apply(Math, durations),\n            maxDelay = Math.max.apply(Math, delays),\n            maxTotal = Math.max.apply(Math, lengths);\n\n        // Which were the longest watched durations and delays?\n        var watchedMaxDuration = Math.max.apply(Math, watchedDurations),\n            watchedMaxDelay = Math.max.apply(Math, watchedDelays),\n            watchedMaxTotal = Math.max.apply(Math, watchedLengths);\n\n        return {\n          stepId: stepId,\n          stepElement: stepElement,\n          children: stepChildren,\n          animatedChildren: stepAnimatedChildren,\n          watchedTimings: {\n            maxDuration: watchedMaxDuration,\n            maxDelay: watchedMaxDelay,\n            maxTotal: watchedMaxTotal\n          },\n          timings: {\n            maxDuration: maxDuration,\n            maxDelay: maxDelay,\n            maxTotal: maxTotal\n          }\n        };\n      },\n\n      /**\n       * How long before the next phase should start?\n       * Ignore the phaseThreshold (on first run for example)\n       */\n      getPhaseThreshold: function(ignorePhaseThreshold, phaseThresholdOption, isAnimating, currentPhaseDuration) {\n\n        var phaseThresholdTime = 0;\n\n        // Ignore the phaseThreshold if the developer wishes for this to happen\n        // if Sequence.js is animating\n        if (isAnimating === true && self.options.ignorePhaseThresholdWhenSkipped === true) {\n          ignorePhaseThreshold = true;\n        }\n\n        if (ignorePhaseThreshold === undefined) {\n\n          if (phaseThresholdOption === true) {\n            // The phaseThreshold should be the length of the current phase\n            // so the next starts immediately after\n            phaseThresholdTime = currentPhaseDuration;\n          } else if (phaseThresholdOption !== false) {\n            // Use the developer defined phaseThreshold\n            phaseThresholdTime = phaseThresholdOption;\n          }\n        }\n\n        return phaseThresholdTime;\n      },\n\n      /**\n       * Do we need to add a delay to account for one phase finishing\n       * before another?\n       *\n       * @param {Number} currentPhaseTotal - Amount of time in milliseconds the\n       * current phase will animate for\n       * @param {Number} nextPhaseTotal - Amount of time in milliseconds the\n       * next phase will animate for\n       * @param {Boolean} ignorePhaseThresholdWhenSkippedOption - if true,\n       * don't use a reversePhaseDelay\n       * @param {Boolean} isAnimating - Whether Sequence is animating\n       * @returns {Object} - Contains times that should delay the next or\n       * current phase accordingly\n       */\n       getReversePhaseDelay: function(currentPhaseTotal, nextPhaseTotal, phaseThresholdOption, ignorePhaseThresholdWhenSkippedOption, isAnimating) {\n\n        var phaseDifference = 0,\n            current = 0,\n            next = 0;\n\n        // Only use a reversePhaseDelay if the phaseThreshold option is true or\n        // a custom time, and Sequence is not animating with the\n        // ignorePhaseThreshold option on\n        if (phaseThresholdOption !== true && (ignorePhaseThresholdWhenSkippedOption === false || isAnimating === false)) {\n            phaseDifference = currentPhaseTotal - nextPhaseTotal;\n\n          if (phaseDifference > 0) {\n            next = phaseDifference;\n          } else if (phaseDifference < 0) {\n            current = Math.abs(phaseDifference);\n          }\n        }\n\n        return {\n          next: next,\n          current: current\n        };\n      },\n\n      /**\n       * If the moveActiveStepToTop option is being used, move the next step\n       * to the top and the current step to the bottom via z-index\n       *\n       * @param {HTMLElement} currentElement - The current step to be moved off\n       * the top\n       * @param {HTMLElement} nextElement - The next step to be moved to the top\n       */\n      moveActiveStepToTop: function(currentElement, nextElement) {\n\n        if (self.options.moveActiveStepToTop === true) {\n\n          var prevStepElement = self.$steps[self.prevStepId - 1],\n              lastStepId = self.noOfSteps - 1;\n\n          prevStepElement.style.zIndex = 1;\n          currentElement.style.zIndex = lastStepId;\n          nextElement.style.zIndex = self.noOfSteps;\n        }\n\n        return null;\n      },\n\n      /**\n       * If the navigationSkipThreshold option is being used, prevent the use\n       * of goTo() during the threshold period\n       *\n       * @param {Number} id - The ID of the step Sequence is trying to go to\n       * @param {HTMLObject} nextStepElement - The element for the next step\n       */\n      manageNavigationSkip: function(id, nextStepElement) {\n\n        if (self.isFallbackMode === true) {\n          return;\n        }\n\n        var i,\n            stepProperties,\n            stepElement,\n            stepId,\n            phaseSkipped;\n\n        // Show the next step again\n        self.ui.show(nextStepElement, 0);\n\n        if (self.options.navigationSkip === true) {\n\n          // Start the navigation skip threshold\n          self.navigationSkipThresholdActive = true;\n\n          // Are there steps currently animating that need to be faded out?\n          if (self.phasesAnimating !== 0) {\n\n            // If a step is waiting to animate in based on the phaseThreshold,\n            // cancel it\n            clearTimeout(self.phaseThresholdTimer);\n            clearTimeout(self.nextPhaseStartedTimer);\n\n            // Fade a step if the user navigates to another prior to its\n            // animation finishing\n            if (self.options.fadeStepWhenSkipped === true) {\n\n              // Fade all elements that are animating\n              // (not including the current one)\n              for (i = 1; i <= self.noOfSteps; i++) {\n\n                stepProperties = self.stepProperties[i];\n\n                // Deal with the steps that were skipped whilst still animating\n                if (stepProperties.isActive === true && i !== id) {\n                  stepElement = self.$steps[i - 1];\n                  stepId = i;\n\n                  phaseSkipped = {};\n                  phaseSkipped.id = stepId;\n                  phaseSkipped.element = stepElement;\n\n                  // Save the ID of the skipped step so we can deal with it when it has faded out\n                  self.phasesSkipped.push(phaseSkipped);\n\n                  // Deal with the skipped step\n                  self.animation.stepSkipped(stepElement);\n                }\n              }\n            }\n          }\n\n          // Start the navigationSkipThreshold timer to prevent being able to\n          // navigate too quickly\n          self.navigationSkipThresholdTimer = setTimeout(function() {\n            self.navigationSkipThresholdActive = false;\n          }, self.options.navigationSkipThreshold);\n        }\n      },\n\n      /**\n       * Deal with a step when it has been skipped\n       *\n       * @param {HTMLElement} stepElement - The step element that was skipped\n       */\n      stepSkipped: function(stepElement) {\n\n        // TODO: Add resetWhenStepSkipped option -\n        // https://github.com/IanLunn/Sequence/issues/257\n        // Reset the skipped steps current and next phase ended timers and trigger\n        // them as soon as the steps have faded out\n\n        // Fade the step out\n        self.ui.hide(stepElement, self.options.fadeStepTime, function() {\n\n        });\n\n      },\n\n      /**\n       * Change a step's class. Example: go from step1 to step2\n       *\n       * @param {Number} id - The ID of the step to change\n       */\n      changeStep: function(id) {\n\n        // Get the step to add\n        var stepToAdd = \"seq-step\" + id;\n\n        // Add the new step and remove the previous\n        if (self.currentStepId !== undefined) {\n\n          var stepToRemove = \"seq-step\" + self.currentStepId;\n\n          addClass(self.$container, stepToAdd);\n          removeClass(self.$container, stepToRemove);\n        }else {\n          addClass(self.$container, stepToAdd);\n        }\n      },\n\n      /**\n       * Apply the reversed properties to all animatable elements within a phase\n       *\n       * @param {Object} phaseProperties - Properties relating to the active phases\n       * (seq-in and seq-out)\n       * @param {Number} phaseDelay - A delay that is added when one phase\n       * animates longer than the other\n       * @param {Number} phaseThresholdTime - The amount of time in milliseconds\n       * before the next step should start animating in\n       * @param {Boolean} ignorePhaseThreshold - if true, ignore the threshold\n       * between phases (breaks reversal of animations but may be used when\n       * skipping navigation etc)\n       * @returns {Number} maxWatchedTotal - The new total length\n       * (duration + delay) for watched elements when reversed\n       */\n      reverseProperties: function(phaseProperties, phaseDelay, phaseThresholdTime, ignorePhaseThreshold, options) {\n\n        var animation = this,\n            phaseElements = phaseProperties.children,\n            noOfPhaseElements = phaseElements.length,\n            stepDurations = phaseProperties.timings,\n            el,\n            i,\n            timingFunction = '',\n            timingFunctionReversed = '',\n            duration,\n            delay,\n            total,\n            maxTotal,\n            maxWatchedTotal,\n            totals = [],\n            watchedTotals = [];\n\n        for (i = 0; i < noOfPhaseElements; i++) {\n          el = phaseElements[i];\n\n          // Get each element's duration and delay\n          duration = convertTimeToMs(getStyle(el, Modernizr.prefixed(\"transitionDuration\")));\n          delay = convertTimeToMs(getStyle(el, Modernizr.prefixed(\"transitionDelay\")));\n\n          // Save the total\n          total = duration + delay;\n\n          // Delay elements in relation to the length of other elements in the\n          // phase eg. If one element A transitions for 1s and element B 2s\n          // element A should be delayed by 1s (element B length - element A length).\n          delay = stepDurations.maxTotal - total;\n\n          // Delay this phase's elements so they animate in relation to the\n          // other phase\n          if (ignorePhaseThreshold !== true) {\n            delay += phaseDelay;\n          }\n\n          // Update the total with the new delay\n          total = duration + delay;\n\n          // Save the total of the reversed animation\n          totals.push(total);\n\n          // Save the total of the reversed animation for watched elements only\n          if (el.getAttribute(\"data-seq\") !== null) {\n            watchedTotals.push(total);\n          }\n\n          // Get the timing-function and reverse it\n          if (options.reverseTimingFunctionWhenNavigatingBackwards === true) {\n            timingFunction = getStyle(el, Modernizr.prefixed(\"transitionTimingFunction\"));\n            timingFunctionReversed = animation.reverseTimingFunction(timingFunction);\n          }\n\n          // Apply the reversed transition properties to each element\n          el.style[Modernizr.prefixed(\"transition\")] = duration + \"ms \" + delay + \"ms \" + timingFunctionReversed;\n        }\n\n        // Get the longest total and delay of the reversed animations\n        maxTotal = Math.max.apply(Math, totals);\n\n        // Get the longest total and delay of the reversed animations (for\n        // watched elements only)\n        maxWatchedTotal = Math.max.apply(Math, watchedTotals);\n\n        // Remove the reversed transition properties from each element once it\n        // has finished animating; allowing for the inherited styles to take\n        // effect again.\n        setTimeout(function() {\n          animation.domDelay(function() {\n            for (i = 0; i < noOfPhaseElements; i++) {\n              el = phaseElements[i];\n\n              el.style[Modernizr.prefixed(\"transition\")] = \"\";\n            }\n          });\n        }, maxTotal + phaseThresholdTime);\n\n        return maxWatchedTotal;\n      },\n\n      /**\n       * Go forward to the next step\n       *\n       * @param {Number} id - The ID of the next step\n       * @param {HTMLObject} currentStepElement - The element for the current step\n       * @param {HTMLObject} nextStepElement - The element for the next step\n       * @param {Boolean} ignorePhaseThreshold - if true, ignore the\n       * transitionThreshold setting and immediately go to the specified step\n       * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n       */\n      forward: function(id, currentStepElement, nextStepElement, ignorePhaseThreshold, hashTagNav) {\n\n        var animation = this,\n            currentPhaseProperties,\n            currentPhaseTotal,\n            phaseThresholdTime;\n\n        if (self.firstRun === false) {\n\n          // Callback\n          animation.currentPhaseStarted(self.currentStepId);\n        }\n\n        // Snap the step to the \"animate-start\" phase\n        removeClass(nextStepElement, \"seq-out\");\n\n        animation.domDelay(function() {\n\n          // Make the current step transition to \"seq-out\"\n          currentPhaseProperties = animation.startAnimateOut(self.currentStepId, currentStepElement, 1);\n\n          // Total duration of the current phase (duration + delay)\n          currentPhaseTotal = currentPhaseProperties.watchedTimings.maxTotal;\n\n          // How long before the next phase should start?\n          phaseThresholdTime = animation.getPhaseThreshold(ignorePhaseThreshold, self.options.phaseThreshold, self.isAnimating, currentPhaseTotal);\n\n          // Sequence is now animating\n          self.isAnimating = true;\n\n          // Make the next step transition to \"seq-in\"\n          animation.startAnimateIn(id, currentPhaseTotal, nextStepElement, phaseThresholdTime, hashTagNav);\n        });\n      },\n\n      /**\n       * Navigate in reverse to the next step\n       *\n       * @param {Number} id - The ID of the next step\n       * @param {HTMLObject} currentStepElement - The element for the current step\n       * @param {HTMLObject} nextStepElement - The element for the next step\n       * @param {Boolean} ignorePhaseThreshold - if true, ignore the\n       * transitionThreshold setting and immediately go to the specified step\n       * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n       */\n      reverse: function(id, currentStepElement, nextStepElement, ignorePhaseThreshold, hashTagNav) {\n\n        var animation = this,\n            currentId,\n            reversePhaseDelay,\n            phaseThresholdTime = 0,\n            currentPhaseProperties,\n            nextPhaseProperties,\n            currentPhaseTotal,\n            nextPhaseTotal;\n\n        // Snap the next phase to \"animate-out\"\n        addClass(nextStepElement, \"seq-out\");\n\n        animation.domDelay(function() {\n\n          // Get the step number, element, its animated elements (child nodes),\n          // and max timings\n          currentPhaseProperties = animation.getPhaseProperties(self.currentStepId, \"current\");\n          nextPhaseProperties = animation.getPhaseProperties(id, \"next\");\n\n          // Determine the gap between phases based on the phaseThreshold option\n          phaseThresholdTime = animation.getPhaseThreshold(ignorePhaseThreshold, self.options.phaseThreshold, self.isAnimating, currentPhaseProperties.timings.maxTotal);\n\n          // Determine if there should be a delay to account for one phase\n          // finishing before the other.\n          // Example: Navigating forward, the next element transitions in over\n          // 1s (A) and the current element over 2s (B). When reversed, the next\n          // element (previouly the current element) should wait 1s (B - A)\n          // before animating back in\n          reversePhaseDelay = animation.getReversePhaseDelay(currentPhaseProperties.timings.maxTotal, nextPhaseProperties.timings.maxTotal, self.options.phaseThreshold, self.options.ignorePhaseThresholdWhenSkipped, self.isAnimating);\n\n          // Reverse properties for all elements in the current and next step\n          // and add the reversePhaseDelay as a transition-delay where necessary\n          currentPhaseTotal = animation.reverseProperties(currentPhaseProperties, reversePhaseDelay.current, 0, ignorePhaseThreshold, self.options);\n          nextPhaseTotal = animation.reverseProperties(nextPhaseProperties, reversePhaseDelay.next, phaseThresholdTime, ignorePhaseThreshold, self.options);\n\n          // Make the current step transition to \"animate-start\"\n          animation.startAnimateOut(self.currentStepId, currentStepElement, -1, currentPhaseTotal);\n\n          // Sequence is now animating\n          self.isAnimating = true;\n\n          if (self.firstRun === false) {\n\n            // Callbacks\n            animation.currentPhaseStarted(self.currentStepId);\n          }\n\n          // Make the next step transition to \"seq-in\"\n          animation.startAnimateIn(id, currentPhaseTotal, nextStepElement, phaseThresholdTime, hashTagNav, nextPhaseTotal);\n        });\n      },\n\n      /**\n       * Start the next step's \"seq-in\" phase\n       *\n       * @param {Number} id - The ID of the next step\n       * @param {Number} currentPhaseTotal - Amount of time in milliseconds the\n       * current phase will animate for\n       * @param {HTMLObject} nextStepElement - The element for the next step\n       * @param {Number} phaseThresholdTime - The amount of time in milliseconds\n       * before the next step should start animating in\n       * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n       * @param {Number} nextPhaseTotal - Amount of time in milliseconds the\n       * next phase will animate for\n       */\n      startAnimateIn: function(id, currentPhaseTotal, nextStepElement, phaseThresholdTime, hashTagNav, nextPhaseTotal) {\n\n        var animation = this,\n            nextPhaseProperties,\n            stepDuration;\n\n        // The next ID is now the current ID\n        self.prevStepId = self.currentStepId;\n        self.currentStepId = id;\n\n        if (self.firstRun === true) {\n          // Update pagination\n          self.pagination.update();\n        }\n\n        // When should the \"seq-in\" phase start and how long until the step\n        // completely finishes animating?\n        if (self.firstRun === false || self.options.startingStepAnimatesIn === true) {\n\n          self.stepProperties[id].isActive = true;\n\n          // Callback\n          self.nextPhaseStartedTimer = setTimeout(function() {\n            animation.nextPhaseStarted(id, hashTagNav);\n          }, phaseThresholdTime);\n\n          // Start the \"seq-in\" phase\n          self.phaseThresholdTimer = setTimeout(function() {\n\n            // TODO: Change multiple classes via one function\n            addClass(nextStepElement, \"seq-in\");\n            removeClass(nextStepElement, \"seq-out\");\n\n            // When animate-in is reversed, this will have already been passed\n            // in as an argument so it's only needed for forward animation\n            if (nextPhaseTotal === undefined) {\n              nextPhaseProperties = self.animation.getPhaseProperties(id, \"next\");\n              nextPhaseTotal = nextPhaseProperties.watchedTimings.maxTotal;\n            }\n\n            // Wait for the next phase to end\n            animation.phaseEnded(id, \"next\", nextPhaseTotal, animation.nextPhaseEnded);\n\n            // How long will it take for the step to end?\n            stepDuration = animation.getStepDuration(currentPhaseTotal, nextPhaseTotal, self.options.phaseThreshold);\n\n            self.stepEndedTimer = setTimeout(function() {\n\n              self.animation.stepEnded(id);\n            }, stepDuration);\n\n          }, phaseThresholdTime);\n        }\n\n        // This is the first run. Snap the first step into place without animation\n        else {\n\n          // Set the first step's speed to 0 to have it immediately snap into place\n          animation.resetInheritedSpeed(id);\n\n          self.phasesAnimating = 0;\n          self.isAnimating = false;\n\n          if (self.options.autoPlay === true) {\n            self.autoPlay.start(true);\n          }\n\n          addClass(nextStepElement, \"seq-in\");\n          removeClass(nextStepElement, \"seq-out\");\n        }\n\n        self.firstRun = false;\n      },\n\n      /**\n       * Start the next step's \"seq-out\" phase\n       *\n       * @param {Number} id - The ID of the next step\n       * @param {HTMLObject} currentStepElement - The element for the current step\n       * @param {Number} direction - The direction of navigation\n       * @param {Number} currentPhaseTotal - Amount of time in milliseconds the\n       * current phase will animate for\n       */\n      startAnimateOut: function(id, currentStepElement, direction, currentPhaseTotal) {\n\n        var animation = this,\n        currentPhaseProperties;\n\n        if (direction === 1) {\n\n          // TODO: Change multiple classes via one function\n          // Make the current step transition to \"animate-out\"\n          removeClass(currentStepElement, \"seq-in\");\n          addClass(currentStepElement, \"seq-out\");\n\n          // Get the step number, element, its animated elements (child nodes), and\n          // max timings\n          currentPhaseProperties = animation.getPhaseProperties(id, \"current\");\n\n          currentPhaseTotal = currentPhaseProperties.watchedTimings.maxTotal;\n\n        } else {\n\n          // Make the current step transition to \"animate-start\"\n          removeClass(currentStepElement, \"seq-in\");\n        }\n\n        if (self.firstRun === false) {\n\n          // Add the steps to the list of active steps\n          self.stepProperties[id].isActive = true;\n\n          // Wait for the current phase to end\n          animation.phaseEnded(id, \"current\", currentPhaseTotal, animation.currentPhaseEnded);\n        }\n\n        return currentPhaseProperties;\n      },\n\n      /**\n       * Determine how long a step will animate for\n       *\n       * @param {Number} currentPhaseTotal - Amount of time in milliseconds the\n       * current phase will animate for\n       * @param {Number} nextPhaseTotal - Amount of time in milliseconds the\n       * next phase will animate for\n       * @param {Number|Boolean} phaseThresholdOption - Amount of time between\n       * phases as defined via the phaseThreshold option\n       * @returns {Number} stepDuration - Which ever is longest, current or next\n       * phase duration\n       */\n      getStepDuration: function(currentPhaseTotal, nextPhaseTotal, phaseThresholdOption) {\n\n        var stepDuration;\n\n        switch (phaseThresholdOption) {\n          case true:\n            stepDuration = nextPhaseTotal;\n          break;\n\n          case false:\n            // The stepDuration is whichever phase is longest\n            stepDuration = (currentPhaseTotal >= nextPhaseTotal) ? currentPhaseTotal : nextPhaseTotal;\n          break;\n\n          default:\n            stepDuration = (currentPhaseTotal >= nextPhaseTotal + phaseThresholdOption) ? (currentPhaseTotal) - phaseThresholdOption : nextPhaseTotal;\n        }\n\n        return stepDuration;\n      },\n\n      /**\n       * When the current phase starts animating\n       */\n      currentPhaseStarted: function(id) {\n\n        self.phasesAnimating++;\n\n        // Callback\n        self.currentPhaseStarted(id, self);\n      },\n\n      /**\n       * When the current phase finishes animating\n       */\n      currentPhaseEnded: function(id) {\n\n        // Callback\n        self.currentPhaseEnded(id, self);\n      },\n\n      /**\n       * When the next phase starts animating\n       *\n       * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n       */\n      nextPhaseStarted: function(id, hashTagNav) {\n\n        self.phasesAnimating++;\n\n        // Update the hashTag if being used\n        if (hashTagNav === undefined) {\n          self.hashTags.update();\n        }\n\n        // Update pagination\n        self.pagination.update();\n\n        // Callback\n        self.nextPhaseStarted(id, self);\n      },\n\n      /**\n       * When the next phase finishes animating\n       */\n      nextPhaseEnded: function(id) {\n\n        // Callback\n        self.nextPhaseEnded(id, self);\n\n      },\n\n      /**\n       * Wait for a phases (seq-in or seq-out) animations to finish\n       *\n       * @param {Number} id - The id of the step the phase belongs to\n       * @param {Number} phaseDuration - The amount of time before the phase\n       * ends (in milliseconds)\n       * @param {Function} callback - A function to execute when the phase ends\n       */\n      phaseEnded: function(id, phase, phaseDuration, callback) {\n\n        var animation = this,\n            phaseEnded;\n\n        phaseEnded = function(id) {\n          self.stepProperties[id].isActive = false;\n          self.phasesAnimating--;\n\n          // Phase callback\n          callback(id);\n        };\n\n        if (phase === \"current\") {\n\n          self.currentPhaseEndedTimer = setTimeout(function() {\n\n            phaseEnded(id);\n          }, phaseDuration);\n        } else {\n\n          self.nextPhaseEndedTimer = setTimeout(function() {\n\n            phaseEnded(id);\n          }, phaseDuration);\n        }\n      },\n\n      /**\n       * When a step's animations have completely finished\n       *\n       * @param {Number} id - The ID of the step that ended\n       * @param {Number} stepDuration - The amount of time before the step\n       * finishes animating\n       */\n      stepEnded: function(id) {\n\n          self.isAnimating = false;\n          self.isAutoPlaying = false;\n\n          // Continue with autoPlay if enabled\n          if (self.options.autoPlay === true) {\n            self.autoPlay.start(true, true);\n          }\n\n          // Callback\n          self.animationEnded(id, self);\n      },\n\n      /**\n       * Change \"seq-out\" to \"seq-in\" and vice-versa.\n       *\n       * @param {String} phase - The phase to reverse\n       * @returns {String} - The reversed phase\n       */\n      reversePhase: function(phase) {\n\n        var reversePhase = {\n            \"seq-out\": \"seq-in\",\n            \"seq-in\": \"seq-out\"\n        };\n\n        return reversePhase[phase];\n      },\n\n      /**\n       * Apply a short delay to a function that manipulates the DOM. Allows for\n       * sequential DOM manipulations.\n       *\n       * Why is this needed?\n       *\n       * When sequentially manipulating a DOM element (ie, removing a class then\n       * immediately applying another on the same element), the first manipulation\n       * appears not to apply. This function puts a small gap between sequential\n       * manipulations to give the browser a chance visually apply each manipulation.\n       *\n       * Some browsers can apply a succession of classes quicker than\n       * this but 50ms is enough to capture even the slowest of browsers.\n       *\n       * @param {Function} callback - a function to run after the delay\n       */\n      domDelay: function(callback) {\n\n        setTimeout(function() {\n          callback();\n        }, domThreshold);\n      },\n\n      /**\n       * Reverse a CSS timing function\n       *\n       * @param {String} timingFunction - The timing function to reverse\n       * @returns {String} timingFunction - The reverse timing function\n       */\n      reverseTimingFunction: function(timingFunction) {\n\n        if (timingFunction === '' || timingFunction === undefined) {\n          return timingFunction;\n        }\n\n        // Convert timingFunction keywords to a cubic-bezier function\n        // This is needed because some browsers return a keyword, others a function\n        var timingFunctionToCubicBezier = {\n          \"linear\"     : \"cubic-bezier(0.0,0.0,1.0,1.0)\",\n          \"ease\"       : \"cubic-bezier(0.25, 0.1, 0.25, 1.0)\",\n          \"ease-in\"    : \"cubic-bezier(0.42, 0.0, 1.0, 1.0)\",\n          \"ease-in-out\": \"cubic-bezier(0.42, 0.0, 0.58, 1.0)\",\n          \"ease-out\"   : \"cubic-bezier(0.0, 0.0, 0.58, 1.0)\"\n        };\n\n        var cubicBezier,\n            cubicBezierLength,\n            reversedCubicBezier,\n            i;\n\n        // Convert the timing function to a cubic-bezier if it is a keyword\n        if (timingFunction.indexOf(\"cubic-bezier\") < 0) {\n\n          // TODO: Support multiple timing-functions\n          // If the timing-function is made up of multiple functions, reduce it\n          // to one only\n          timingFunction = timingFunction.split(\",\")[0];\n\n          // Convert\n          timingFunction = timingFunctionToCubicBezier[timingFunction];\n        }\n\n        // Remove the CSS function and just get the array of points\n        cubicBezier = timingFunction.replace(\"cubic-bezier(\", \"\").replace(\")\", \"\").split(\",\");\n        cubicBezierLength = cubicBezier.length;\n\n        // Convert each point into a number (rather than a string)\n        for (i = 0; i < cubicBezierLength; i++) {\n          cubicBezier[i] = parseFloat(cubicBezier[i]);\n        }\n\n        // Reverse the cubic bezier\n        reversedCubicBezier = [\n          1 - cubicBezier[2],\n          1 - cubicBezier[3],\n          1 - cubicBezier[0],\n          1 - cubicBezier[1]\n        ];\n\n        // Add the reversed cubic bezier back into a CSS function\n        timingFunction = \"cubic-bezier(\" + reversedCubicBezier + \")\";\n\n        return timingFunction;\n      },\n\n      /**\n       * Apply a transition-duration and transition-delay to each element\n       * then remove these temporary values once the phase is reset.\n       *\n       * Can be used to apply 0 to both duration and delay so animates reset\n       * back into their original places for example.\n       *\n       * @param {String} step - The step that the elements we'll reset belong to\n       */\n      resetInheritedSpeed: function(step) {\n\n        if (self.isFallbackMode === true) {\n          return;\n        }\n\n        var animation = this,\n            el,\n            i;\n\n        // Get the step's elements and count them\n        var stepElements = self.$steps[step - 1].querySelectorAll(\"*\"),\n            numberOfStepElements = stepElements.length;\n\n        // Temporarily apply a transition-duration and transition-delay to each\n        // element we need to track.\n        for (i = 0; i < numberOfStepElements; i++) {\n          el = stepElements[i];\n\n          el.style[Modernizr.prefixed(\"transition\")] = \"0ms 0ms\";\n        }\n\n        /**\n         * Note: Synchronously, an element's phase class is added/removed here.\n         * To save the need for a callback though (and extra code), we instead rely\n         * on the necessity for the .domDelay() function which doesn't remove the\n         * inheritedStyles until after a brief delay. What would be the callback\n         * is instead just placed after the call to .resetInheritedSpeed() and\n         * from a synchronous point of view, occurs at this point, before the\n         * following .domDelay();\n         */\n\n        // Remove the temporary transition-duration and transition-delay from each\n        // element now it has been manipulated; allowing for the inherited styles\n        // to take effect again.\n        self.animation.domDelay(function() {\n\n          for (i = 0; i < numberOfStepElements; i++) {\n\n            el = stepElements[i];\n            el.style[Modernizr.prefixed(\"transition\")] = \"\";\n          }\n        });\n      },\n\n      /**\n       * Get the direction to navigate in based on whether the .goTo() function\n       * has a defined direction, and if not, what options are being used.\n       *\n       * @param {Number} id - The id of the step to go to\n       * @param {Number} definedDirection - The defined direction 1 or -1\n       * @returns {Number} direction - The direction 1 or -1\n       */\n      getDirection: function(id, definedDirection, currentStepId, noOfSteps, isFallbackMode, reverseWhenNavigatingBackwardsOption, cycleOption) {\n\n        var animation = this,\n            direction = 1;\n\n        if (definedDirection !== undefined) {\n          direction = definedDirection;\n        } else if (reverseWhenNavigatingBackwardsOption === true || isFallbackMode === true) {\n\n          if (cycleOption === true && (id === 1 && currentStepId === noOfSteps)) {\n            // If the cycle option is enabled, and the user is navigating from\n            // the last step to the first, navigate forwards\n            direction = 1;\n          } else {\n            direction = (id < currentStepId) ? -1: 1;\n          }\n        } else {\n          direction = 1;\n        }\n\n        return direction;\n      },\n\n      /**\n       * Does Sequence need to go into fallback mode because the browser doesn't\n       * support transitions?\n       *\n       * @param {Object} propertySupport - List of properties and whether the\n       * browser supports them\n       */\n      requiresFallbackMode: function(propertySupport) {\n\n        var transitions = propertySupport.transitions,\n            isFallbackMode = false;\n\n        if (transitions === false) {\n          isFallbackMode = true;\n        }\n\n        return isFallbackMode;\n      },\n\n      /**\n       * Determine what properties the browser supports. Currently tests:\n       *\n       * - transitions\n       * - animations\n       *\n       * @param {Object} properties - The properties to be used (on the canvas)\n       * @returns {Object} The list of properties we've tested and their support\n       */\n      getPropertySupport: function(properties) {\n\n        var transitions = false,\n            animations = false;\n\n        // Are transitions supported?\n        if (Modernizr.csstransitions === true) {\n          transitions = true;\n        }\n\n        // Are animations supported?\n        if (Modernizr.cssanimations === true) {\n          animations = true;\n        }\n\n        return {\n          transitions: transitions,\n          animations: animations\n        };\n      }\n    };\n\n    /**\n     * Controls Sequence's animations when in a browser that doesn't support\n     * CSS transitions\n     */\n    self.animationFallback = {\n\n      /**\n       * Animate an element using JavaScript\n       *\n       * @param {HTMLElement} element - The element to animate\n       * @param {String} style - The style to be animated\n       * @param {String} unit - The value unit such as \"px\", \"%\" etc\n       * @param {Number} from - The start value of the animation\n       * @param {Number} to - The end value of the animation\n       * @param {Number} time - how long to animate for\n       * @param {Function} callback - A function to execute once the animation\n       * has finished\n       */\n      animate: function(element, style, unit, from, to, time, callback) {\n\n        if (element === false) {\n          return;\n        }\n\n        var start = new Date().getTime();\n\n        var timer = setInterval(function() {\n\n          var step = Math.min(1, (new Date().getTime()-start) / time);\n\n          element.style[style] = (from + step * (to - from)) + unit;\n\n          if (step === 1) {\n\n            if (callback !== undefined) {\n              callback();\n            }\n\n            clearInterval(timer);\n          }\n        }, 25);\n\n        element.style[style] = from + unit;\n      },\n\n      /**\n       * Setup the canvas ready for the fallback animation\n       *\n       * @param {Number} id - The first Id that Sequence will go to\n       */\n      setupCanvas: function(id) {\n\n        var i,\n            step,\n            stepId;\n\n        if (self.isFallbackMode === true) {\n\n          // Add the \"seq-fallback\" class to the Sequence element\n          addClass(self.$container, \"seq-fallback\");\n\n          if (self.$screen !== undefined) {\n            // Prevent steps from appearing outside of the Sequence screen\n            self.$screen.style.overflow = \"hidden\";\n            self.$screen.style.width = \"100%\";\n            self.$screen.style.height = \"100%\";\n          }\n\n          // Make the canvas and screen 100% width/height\n          self.$canvas.style.width = \"100%\";\n          self.$canvas.style.height = \"100%\";\n\n\n          // Get the width of the canvas\n          this.canvasWidth = self.$canvas.offsetWidth;\n\n          // Make each step 100% width/height\n          for (i = 0; i < self.noOfSteps; i++) {\n\n            // Get the step and its ID (one-based)\n            step = self.$steps[i];\n            stepId = i + 1;\n\n            /**\n             * Move each step to its \"seq-in\" position\n             *\n             * Note: in fallback mode, steps will always remain in their\n             * \"seq-in\" position\n             */\n            addClass(step, \"seq-in\");\n\n            // Make the step 100% width/height\n            step.style.width = \"100%\";\n            step.style.height = \"100%\";\n            step.style.position = \"absolute\";\n            step.style.whiteSpace = \"normal\";\n\n            // Move all steps to \"seq-out\"\n            step.style.left = \"100%\";\n          }\n        }\n      },\n\n      /**\n       * Move the canvas using basic animation\n       *\n       * @param {HTMLElement} nextStepElement - The element that is the next step\n       * @param {HTMLElement} currentStepElement - The element that is the current step\n       * @param {Number} direction - The direction to animate in\n       * @param {Boolean} animate - Show the canvas animate or snap?\n       */\n      moveCanvas: function(nextStepElement, currentStepElement, direction, animate) {\n\n        // Animate steps\n        if (animate === true) {\n\n          var currentFrom = 0,\n              currentTo = -100,\n              nextFrom = 100,\n              nextTo = 0;\n\n          if (direction === -1) {\n            currentTo = 100;\n            nextFrom = -100;\n          }\n\n          this.animate(currentStepElement, \"left\", \"%\", currentFrom, currentTo, self.options.fallback.speed);\n          this.animate(nextStepElement, \"left\", \"%\", nextFrom, nextTo, self.options.fallback.speed);\n        }\n\n        // Snap steps into place\n        else {\n\n          currentStepElement.style.left = \"-100%\";\n          nextStepElement.style.left = \"0\";\n        }\n      },\n\n      /**\n       * Go to a step using basic animation\n       *\n       * @param {Number} id - The ID of the step to go to\n       * @param {String} currentStep - The name of the current step\n       * @param {HTMLElement} currentStepElement - The element that is the current step\n       * @param {String} nextStep - The name of the next step\n       * @param {HTMLElement} nextStepElement - The element that is the next step\n       * @param {Number} direction - The direction of navigation\n       * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n       */\n      goTo: function(id, currentStep, currentStepElement, nextStep, nextStepElement, direction, hashTagNav) {\n\n        var from;\n\n        // The next ID is now the current ID\n        self.prevStepId = self.currentStepId;\n        self.currentStepId = id;\n\n        // Update the hashTag if being used\n        if (hashTagNav === undefined) {\n          self.hashTags.update();\n        }\n\n        self.pagination.update();\n\n        // When should the \"seq-in\" phase start and how long until the step\n        // completely finishes animating?\n        if (self.firstRun === false) {\n\n          this.moveCanvas(nextStepElement, currentStepElement, direction, true);\n\n          // Sequence is now animating\n          self.isAnimating = true;\n\n          // Callback\n          self.animationStarted(self.currentStepId, self);\n\n          // Wait for the step (both phases) to finish animating\n          self.stepEndedTimer = setTimeout(function() {\n\n            self.animation.stepEnded(self.currentStepId);\n          }, self.options.fallback.speed);\n        }\n\n        // This is the first step we're going to\n        else {\n\n          this.moveCanvas(nextStepElement, currentStepElement, direction, false);\n          self.firstRun = false;\n\n          if (self.options.autoPlay === true) {\n            self.autoPlay.start(true);\n          }\n        }\n      }\n    };\n\n    /**\n     * Manage pagination\n     */\n    self.pagination = {\n\n      /**\n       * Get the links from each pagination element (any top level elements)\n       *\n       * @param {HTMLElement} element - The pagination element\n       * @param {String} rel - Which Sequence element the pagination relates\n       * to (if any)\n       * @param {Number} i - The number of the pagination element\n       * @returns {Array} paginationLinks - Each link in an array\n       */\n      getLinks: function(element, rel) {\n\n        var childElement,\n            childElements = element.childNodes,\n            childElementsLength = childElements.length,\n            paginationLinks = [],\n            i;\n\n        // Get each top level pagination link and add it to the array\n        for (i = 0; i < childElementsLength; i++) {\n\n          childElement = childElements[i];\n\n          if (childElement.nodeType === 1) {\n            paginationLinks.push(childElement);\n          }\n        }\n\n        return paginationLinks;\n      },\n\n      /**\n       * Update the pagination to activate the relevant link\n       *\n       * @returns {Array} - the pagination element(s) that are currently active\n       */\n      update: function() {\n\n        if(self.$pagination.elements !== undefined) {\n\n          var i,\n              j,\n              id = self.currentStepId - 1,\n              currentPaginationLink,\n              currentPaginationLinksLength,\n              paginationLength = self.$pagination.elements.length;\n\n          // Remove the \"seq-current\" class from a previous pagination link\n          // if there is one\n          if (self.$pagination.currentLinks !== undefined) {\n\n            currentPaginationLinksLength = self.$pagination.currentLinks.length;\n\n            for (i = 0; i < currentPaginationLinksLength; i++) {\n\n              currentPaginationLink = self.$pagination.currentLinks[i];\n              removeClass(currentPaginationLink, \"seq-current\");\n            }\n          }\n\n          // Where we'll save the current pagination links\n          self.$pagination.currentLinks = [];\n\n          // Get the current pagination link from each pagination element,\n          // add the \"seq-current\" class to them, then save them for later\n          // for when they need to have the \"seq-current\" class removed\n          for (j = 0; j < paginationLength; j++) {\n\n            currentPaginationLink = self.$pagination.links[j][id];\n            self.$pagination.currentLinks.push(currentPaginationLink);\n\n            addClass(currentPaginationLink, \"seq-current\");\n          }\n        }\n\n        return self.$pagination.currentLinks;\n      }\n    };\n\n    /**\n     * Manage Sequence hashTag support\n     */\n    self.hashTags = {\n\n      /**\n       * Set up hashTags\n       *\n       * @param {Number} id - The id of the first step\n       * @returns {Number} id - The id of the first step (hashTags.init() will\n       * override this if an entering URL contains a hashTag that corresponds\n       * to a step)\n       */\n      init: function(id) {\n\n        if (self.options.hashTags === true) {\n\n          var correspondingStepId,\n              newHashTag;\n\n          // Does the browser support pushstate?\n          self.hasPushstate = !!(window.history && history.pushState);\n\n          // Get the current hashTag\n          newHashTag = location.hash.replace(\"#!\", \"\");\n\n          // Get each step's hashTag\n          self.stepHashTags = this.getStepHashTags();\n\n          // If there is a hashTag but no value, don't go any further\n          if (newHashTag !== \"\") {\n\n            // Get the current hashTag's step ID's\n            self.currentHashTag = newHashTag;\n            correspondingStepId = this.hasCorrespondingStep(self.currentHashTag);\n\n            // If the entering URL contains a hashTag, and the hashTag relates to\n            // a corresponding step, the step's ID will override the startStepId\n            // defined in options\n            if (correspondingStepId > -1) {\n              id = correspondingStepId + 1;\n            }\n          }\n        }\n\n        // Return either the startingStepId as defined in settings or if the\n        // entering URL contained a hashTag that corresponds to a step, return\n        // its ID instead\n        return id;\n      },\n\n      /**\n       * Does a hashTag have a corresponding step?\n       *\n       * @returns {Number} correspondingStep - The step ID relating to the hashTag or -1 meaning there is no correspondingStep\n       */\n      hasCorrespondingStep: function(hashTag) {\n\n        var correspondingStep = -1,\n            correspondingStepId = self.stepHashTags.indexOf(hashTag);\n\n        if (correspondingStepId > -1) {\n          correspondingStep = correspondingStepId;\n        }\n\n        return correspondingStep;\n      },\n\n      /**\n       * Get each steps hashTag to return an array of hashTags\n       *\n       * @returns {Array} stepHashTags - An array of hashTags\n       */\n      getStepHashTags: function() {\n\n        var i,\n            elementHashTag,\n            stepHashTags = [];\n\n        // Get each steps hashtag\n        for (i = 0; i < self.noOfSteps; i++) {\n\n          elementHashTag = (self.options.hashDataAttribute === false) ? self.$steps[i].id: self.$steps[i].getAttribute(\"data-seq-hashtag\");\n\n          // Add the hashtag to an array\n          stepHashTags.push(elementHashTag);\n        }\n\n        return stepHashTags;\n      },\n\n      /**\n       * Update the hashTag if:\n       *\n       * - hashTags are being used and this isn't the first run\n       * - hashTags are being used, this is the first run, and the first hash\n       *   change is allowed in the options\n       * - the current step has a hashTag\n       */\n      update: function() {\n\n        if (self.options.hashTags === true && self.firstRun === false || (self.options.hashTags === true && self.firstRun === true && self.options.hashChangesOnFirstStep === true)) {\n\n          // Zero-base the currentStepId\n          var hashTagId = self.currentStepId - 1;\n\n          // Get the current hashTag\n          self.currentHashTag = self.stepHashTags[hashTagId];\n\n          if (self.currentHashtag !== \"\") {\n\n            // Add the hashTag to the URL\n            if (self.hasPushstate === true) {\n              history.pushState(null, null, \"#!\" + self.currentHashTag);\n            }\n            else {\n              location.hash = \"#!\" + self.currentHashTag;\n            }\n          }\n        }\n      },\n\n      /**\n       * Cross Browser helper for an hashchange event\n       * Source: http://stackoverflow.com/questions/9339865/get-the-hashchange-event-to-work-in-all-browsers-including-ie7/\n       */\n      setupEvent: function() {\n\n        if ('onhashchange' in window) {\n\n          if (window.addEventListener) {\n\n            window.addHashChange = function(func, before) {\n              window.addEventListener('hashchange', func, before);\n            };\n\n            window.removeHashChange = function(func) {\n              window.removeEventListener('hashchange', func);\n            };\n\n            return;\n\n          } else if (window.attachEvent) {\n\n            window.addHashChange = function(func) {\n              window.attachEvent('onhashchange', func);\n            };\n\n            window.removeHashChange = function(func) {\n              window.detachEvent('onhashchange', func);\n            };\n\n            return;\n          }\n        }\n\n        var hashChangeFuncs = [];\n        var oldHref = location.href;\n\n        window.addHashChange = function(func, before) {\n          if (typeof func === 'function') {\n            hashChangeFuncs[before?'unshift':'push'](func);\n          }\n        };\n\n        window.removeHashChange = function(func) {\n          for (var i=hashChangeFuncs.length-1; i>=0; i--) {\n            if (hashChangeFuncs[i] === func) {\n              hashChangeFuncs.splice(i, 1);\n            }\n          }\n        };\n\n        setInterval(function() {\n          var newHref = location.href;\n          if (oldHref !== newHref) {\n            var _oldHref = oldHref;\n            oldHref = newHref;\n            for (var i=0; i<hashChangeFuncs.length; i++) {\n              hashChangeFuncs[i].call(window, {\n                'type': 'hashchange',\n                'newURL': newHref,\n                'oldURL': _oldHref\n              });\n            }\n          }\n        }, 100);\n      }\n    };\n\n    /**\n     * Manage Sequence preloading\n     */\n    self.preload = {\n\n      // Sequence's default HTML for the preloader\n      defaultHtml: '<svg width=\"39\" height=\"16\" viewBox=\"0 0 39 16\" xmlns=\"http://www.w3.org/2000/svg\" class=\"seq-preload-indicator\"><title>Sequence.js Preloading Indicator</title><desc>Three orange dots increasing in size from left to right</desc><g fill=\"#F96D38\"><path class=\"seq-preload-circle seq-preload-circle-1\" d=\"M3.999 12.012c2.209 0 3.999-1.791 3.999-3.999s-1.79-3.999-3.999-3.999-3.999 1.791-3.999 3.999 1.79 3.999 3.999 3.999z\"/><path class=\"seq-preload-circle seq-preload-circle-2\" d=\"M15.996 13.468c3.018 0 5.465-2.447 5.465-5.466 0-3.018-2.447-5.465-5.465-5.465-3.019 0-5.466 2.447-5.466 5.465 0 3.019 2.447 5.466 5.466 5.466z\"/><path class=\"seq-preload-circle seq-preload-circle-3\" d=\"M31.322 15.334c4.049 0 7.332-3.282 7.332-7.332 0-4.049-3.282-7.332-7.332-7.332s-7.332 3.283-7.332 7.332c0 4.05 3.283 7.332 7.332 7.332z\"/></g></svg>',\n\n      fallbackHtml: '<div class=\"seq-preload-indicator seq-preload-indicator-fallback\"><div class=\"seq-preload-circle seq-preload-circle-1\"></div><div class=\"seq-preload-circle seq-preload-circle-2\"></div><div class=\"seq-preload-circle seq-preload-circle-3\"></div></div>',\n\n      // Sequence's default preloader styles and animation for the preloader\n       defaultStyles: '@'+prefixTranslations.animation[Modernizr.prefixed(\"animation\")]+'keyframes seq-preloader {50% {opacity: 1;}100% {opacity: 0;}}.seq-preloader {background: white;visibility: visible;opacity: 1;position: absolute;z-index: 9999;height: 100%;width: 100%;top: 0;left: 0;right: 0;bottom: 0;} .seq-preloader.seq-preloaded {opacity: 0;visibility: hidden;'+Modernizr.prefixed(\"transition\")+': visibility 0s .5s, opacity .5s;}.seq-preload-indicator {overflow: visible;position: relative;top: 50%;left: 50%;-webkit-transform: translate(-50%, -50%);transform: translate(-50%, -50%);}.seq-preload-circle {display: inline-block;height: 12px;width: 12px;fill: #F96D38;opacity: 0;'+prefixTranslations.animation[Modernizr.prefixed(\"animation\")]+'animation: seq-preloader 1.25s infinite;}.seq-preload-circle-2 {'+prefixTranslations.animation[Modernizr.prefixed(\"animation\")]+'animation-delay: .15s;}.seq-preload-circle-3 {'+prefixTranslations.animation[Modernizr.prefixed(\"animation\")]+'animation-delay: .3s;}.seq-preload-indicator-fallback{width: 42px;margin-left: -21px;overflow: visible;}.seq-preload-indicator-fallback .seq-preload-circle {width: 8px; height:8px;background-color: #F96D38;border-radius: 100%; opacity: 1;display: inline-block; vertical-align: middle;}.seq-preload-indicator-fallback .seq-preload-circle-2{margin-left: 3px; margin-right: 3px; width: 12px; height: 12px;}.seq-preload-indicator-fallback .seq-preload-circle-3{width: 16px; height: 16px;}',\n\n      /**\n       * Setup Sequence preloading\n       *\n       * @param {Function} callback - Function to execute when preloading has finished\n       * @returns {Boolean} Whether preload was initiated\n       */\n      init: function(callback) {\n\n        if (self.options.preloader !== false) {\n\n          var preload = this,\n              stepImagesToPreload,\n              individualImagesToPreload,\n              imagesToPreload,\n              imgLoad,\n              progress,\n              result;\n\n          // Add a class of \"seq-preloading\" to the Sequence element\n          addClass(self.$container, \"seq-preloading\");\n\n          // Get the preloader\n          self.$preloader = self.ui.getElements(\"preloader\", self.options.preloader);\n\n          // Add the preloader element if necessary\n          preload.append();\n\n          // Add the preloader's default styles\n          preload.addStyles();\n\n          // Hide steps if necessary\n          preload.toggleStepsVisibility(\"hide\");\n\n          // Get images from particular Sequence steps to be preloaded\n          // Get images with specific source values to be preloaded\n          stepImagesToPreload = preload.getImagesToPreload(self.options.preloadTheseSteps);\n          individualImagesToPreload = preload.getImagesToPreload(self.options.preloadTheseImages, true);\n\n          // Combine step images and individual images\n          imagesToPreload = stepImagesToPreload.concat(individualImagesToPreload);\n\n          // Initiate the imagesLoaded plugin\n          imgLoad = imagesLoaded(imagesToPreload);\n\n          // When imagesLoaded() has finished (regardless of whether images\n          // completed or failed to load)\n          imgLoad.on(\"always\", function(instance) {\n            preload.complete(callback);\n          });\n\n          // Track the number of images that have loaded so far\n          progress = 1;\n\n          imgLoad.on(\"progress\", function(instance, image) {\n\n            // Has the image loaded or is it broken?\n            result = image.isLoaded ? 'loaded': 'broken';\n\n            // Callback\n            self.preloadProgress(result, image.img.src, progress++, imagesToPreload.length, self);\n          });\n\n          return true;\n        }\n\n        return false;\n      },\n\n      /**\n       * When preloading has finished, show the steps again and hide the preloader\n       *\n       * @param {Function} callback - Function to execute when preloading has finished\n       */\n      complete: function(callback) {\n\n        // Callback\n        self.preloaded(self);\n\n        // (Debugging only) prevent the preloader from hiding so it's styles\n        // can be tested\n        if (self.options.pausePreloader === true) {\n          return;\n        }\n\n        // Show steps if necessary\n        this.toggleStepsVisibility(\"show\");\n\n        // Remove the \"preloading\" class and add the \"preloaded\" class\n        removeClass(self.$container, \"seq-preloading\");\n        addClass(self.$container, \"seq-preloaded\");\n        addClass(self.$preloader[0], \"seq-preloaded\");\n\n        if (this.preloadIndicatorTimer !== undefined) {\n          clearInterval(this.preloadIndicatorTimer);\n        }\n\n        // Remove the fallback preloader\n        if (Modernizr.prefixed(\"animation\") === false || Modernizr.svg === false) {\n          self.$preloader[0].style.display = \"none\";\n        }\n\n        if (callback !== undefined) {\n          callback();\n        }\n      },\n\n      /**\n       * Add the preloader's styles to the <head></head>\n       */\n      addStyles: function() {\n\n        if (self.options.preloader === true) {\n\n          // Get the <head> and create the <style> element\n          var head = document.head || document.getElementsByTagName('head')[0];\n          this.styleElement = document.createElement('style');\n\n          // Add the default styles to the <style> element\n          this.styleElement.type = 'text/css';\n          if (this.styleElement.styleSheet) {\n            this.styleElement.styleSheet.cssText = this.defaultStyles;\n          } else {\n            this.styleElement.appendChild(document.createTextNode(this.defaultStyles));\n          }\n\n          // Add the <style> element to the <head>\n          head.appendChild(this.styleElement);\n\n          // Animate the preloader using JavaScript if the browser doesn't support SVG\n          if (Modernizr.prefixed(\"animation\") === false || Modernizr.svg === false) {\n\n            // Get the preload indicator\n            var preloadIndicator = self.$preloader[0].firstChild;\n\n            var indicatorFlash = function() {\n              preloadIndicator.style.visibility = \"hidden\";\n              preloadFlashTime = 1000;\n              setTimeout(function() {\n                preloadIndicator.style.visibility = \"visible\";\n              }, 500);\n            };\n\n            indicatorFlash();\n\n            // Make the preload indicator flash\n            this.preloadIndicatorTimer = setInterval(function() {\n              indicatorFlash();\n            }, 1000);\n          }\n\n          return true;\n        }\n\n        return false;\n      },\n\n      /**\n       * Remove the preloader's styles from the <head></head>\n       */\n      removeStyles: function() {\n\n        this.styleElement.parentNode.removeChild(this.styleElement);\n      },\n\n      /**\n       * Get <img> elements and return them to be preloaded. Elements can be got\n       * either via the <img> element itself or a src attribute.\n       *\n       * @param {Array} elements - An integer array of steps to get images from or a string array of image sources\n       * @param {Boolean} srcOnly - Is the element to be retrieved via the src?\n       * @returns {Array} imagesToPreload - The images to preload in an array\n       */\n      getImagesToPreload: function(elements, srcOnly) {\n\n        // Where we'll save the images\n        var imagesToPreload = [];\n\n        if (isArray(elements) === true) {\n\n          var i,\n              j,\n              elementLength = elements.length,\n              step,\n              imagesInStep,\n              imagesInStepLength,\n              image,\n              img,\n              src;\n\n          // Get each step's <img> elements and add them to imagesToPreload\n          if (srcOnly !== true) {\n\n            // Get each step\n            for (i = 0; i < elementLength; i++) {\n\n              // Get the step and any images belonging to it\n              step = self.$steps[i];\n              imagesInStep = step.getElementsByTagName(\"img\");\n              imagesInStepLength = imagesInStep.length;\n\n              // Get each image within the step\n              for (j = 0; j < imagesInStepLength; j++) {\n\n                image = imagesInStep[j];\n                imagesToPreload.push(image);\n              }\n            }\n          }\n\n          // Get each step's <img> elements via the src and add them to imagesToPreload\n          else {\n\n            img = [];\n\n            for (i = 0; i < elementLength; i++) {\n              src = elements[i];\n\n              img[i] = new Image();\n              img[i].src = src;\n\n              imagesToPreload.push(img[i]);\n            }\n          }\n        }\n\n        return imagesToPreload;\n      },\n\n      /**\n       * Append the default preloader\n       *\n       * @returns {Boolean} whether the default preloader was appended or not\n       */\n      append: function() {\n\n        if (self.options.preloader === true) {\n\n          // Set up the preloader container\n          self.$preloader = document.createElement(\"div\");\n          self.$preloader.className = \"seq-preloader\";\n\n          // Convert the preloader to an array\n          self.$preloader = [self.$preloader];\n\n          // Use the fallback preloader if CSS keyframes or SVG aren't supported\n          if (Modernizr.prefixed(\"animation\") !== false && Modernizr.svg === true) {\n            self.$preloader[0].innerHTML = self.preload.defaultHtml;\n          } else {\n            self.$preloader[0].innerHTML = self.preload.fallbackHtml;\n          }\n\n          // Add the preloader\n          self.$container.insertBefore(self.$preloader[0], null);\n\n          return true;\n        }\n\n        return false;\n      },\n\n      /**\n       * If enabled, hide/show Sequence steps until preloading has finished\n       *\n       * @param {String} type - \"show\" or \"hide\"\n       */\n      toggleStepsVisibility: function(type) {\n\n        if (self.options.hideStepsUntilPreloaded === true) {\n\n          var i,\n              step;\n\n          // Hide or show each step\n          for (i = 0; i < self.noOfSteps; i++) {\n            step = self.$steps[i];\n\n            if (type === \"hide\") {\n              self.ui.hide(step, 0);\n            }else {\n              self.ui.show(step, 0);\n            }\n\n          }\n\n          return true;\n        }\n\n        return false;\n      }\n    };\n\n    /**\n     * Add and remove Sequence events\n     */\n    self.manageEvents = {\n\n      // Keep track of the added events here\n      list: {\n        \"load\": [],\n        \"click\": [],\n        \"touchstart\": [],\n        \"mousemove\": [],\n        \"mouseleave\": [],\n        \"hammer\": [],\n        \"keyup\": [],\n        \"hashchange\": [],\n        \"resize\": []\n      },\n\n      /**\n       * Set up events on init\n       */\n      init: function() {\n\n        // Add visibilityChange to the list of events\n        self.manageEvents.list[visibilityChange] = [];\n\n        if (self.options.hashTags === true) {\n          this.add.hashChange();\n        }\n\n        if (self.options.swipeNavigation === true) {\n          this.add.swipeNavigation();\n        } else {\n          self.hammerTime = false;\n        }\n\n        if (self.options.keyNavigation === true) {\n          this.add.keyNavigation();\n        }\n\n        // Throttles the resize event to once every 100ms\n        this.add.resizeThrottle();\n\n        // Used to start/stop Sequence when page visibility changes\n        this.add.pageVisibility();\n\n        // If being used, get the next button(s) and set up the events\n        if (self.options.nextButton !== false) {\n          self.$next = self.ui.getElements(\"nextButton\", self.options.nextButton);\n          this.add.button(self.$next, \"nav\", self.next);\n        }\n\n        // If being used, get the next button(s) and set up the events\n        if (self.options.prevButton !== false) {\n          self.$prev = self.ui.getElements(\"prevButton\", self.options.prevButton);\n          this.add.button(self.$prev, \"nav\", self.prev);\n        }\n\n        // If being used, get the autoPlay button(s) and set up the events\n        if (self.options.autoPlayButton !== false) {\n          self.$autoPlay = self.ui.getElements(\"autoPlayButton\", self.options.autoPlayButton);\n          this.add.button(self.$autoPlay, \"nav\", self.toggleAutoPlay);\n        }\n\n        // If being used, set up the stopOnHover event\n        this.add.stopOnHover();\n\n        // If being used, get the pagination element(s) and set up the events\n        if (self.options.pagination !== false) {\n\n          self.$pagination = {};\n\n          // The Sequence element and the links that will control it\n          self.$pagination.relatedElementId = instance;\n          self.$pagination.links = [];\n\n          self.$pagination.elements = self.ui.getElements(\"pagination\", self.options.pagination);\n\n          this.add.button(self.$pagination.elements, \"pagination\");\n        }\n\n        return null;\n      },\n\n      /**\n       * Remove all events at once\n       */\n      removeAll: function(eventList) {\n\n        var eventType,\n            theEvents;\n\n        // Remove each event\n        for (eventType in eventList) {\n          if (eventList.hasOwnProperty(eventType) === true) {\n\n            theEvents = eventList[eventType];\n\n            this.remove(eventType);\n          }\n        }\n\n        return null;\n      },\n\n      /**\n       * Remove an event from all of the elements it is attached to\n       *\n       * @param {String} type - The type of event to remove eg. \"click\"\n       */\n      remove: function(type) {\n\n        // Get the elements using the event and count them\n        var eventElements = self.manageEvents.list[type];\n        var eventElementsLength = eventElements.length;\n\n        switch(type) {\n\n          case \"hashchange\":\n            if (self.options.hashTags === true) {\n              removeHashChange(eventElements[0].handler);\n            }\n          break;\n\n          case \"hammer\":\n\n            if (self.manageEvents.list.hammer.length > 0 && document.querySelectorAll !== undefined) {\n\n              var handler = self.manageEvents.list.hammer[0].handler;\n              self.hammerTime.off(\"swipe\", [handler]);\n            }\n          break;\n\n          default:\n\n            // Remove the event from each element\n            for (var i = 0; i < eventElementsLength; i++) {\n              var eventProperties = eventElements[i];\n\n              removeEvent(eventProperties.element, type, eventProperties.handler);\n            }\n        }\n      },\n\n      add: {\n\n        /**\n         * Add the hashchange event\n         *\n         * @returns {Array} Containing an object with the element and handler\n         */\n        hashChange: function() {\n\n          // Setup the cross-browser hashchange event\n          self.hashTags.setupEvent();\n\n          var handler = function(e) {\n\n            var newHashTag,\n                id;\n\n            // Get the hashTag from the URL\n            newHashTag = e.newURL || location.href;\n            newHashTag = newHashTag.split(\"#!\")[1];\n\n            // Go to the new step if we're not already on it\n            if (self.currentHashTag !== newHashTag) {\n\n              // Get the ID of the new hash tag and one-base it\n              id = self.stepHashTags.indexOf(newHashTag) + 1;\n\n              self.currentHashTag = newHashTag;\n\n              /**\n               * Go to the new step\n               *\n               * Note: When the user is navigating through history via their\n               * browser's back/forward buttons for example, we can't prevent\n               * going to a step to meet the navigationSkipThreshold option. To\n               * prevent the hashTag and the current step from becoming\n               * unsynchronized we must ignore the navigationSkipThreshold\n               * setting.\n               */\n              self.goTo(id, undefined, undefined, true);\n            }\n          };\n\n          addHashChange(handler);\n\n          self.manageEvents.list.hashchange.push({\"element\": window, \"handler\": handler});\n\n          return self.manageEvents.list.hashchange;\n        },\n\n        /**\n         * Add  buttons\n         *\n         * @param {Array} elements - The element or elements acting as the next button\n         * @param {String} type - The type of button being added - \"nav\" or \"pagination\"\n         * @param {Function} callback - Function to execute when the button is clicked\n         * @returns {Array} Containing an object with the element and handler\n         */\n        button: function(elements, type, callback) {\n\n          // Count the number of elements being added\n          var elementsLength = elements.length,\n              handler,\n              element,\n              targetElement,\n              buttonEvent,\n              parent,\n              rel,\n              id,\n              i;\n\n          switch (type) {\n\n            // Set up a click event for navigation elements\n            case \"nav\":\n\n              buttonEvent = function(element) {\n\n                handler = addEvent(element, \"click\", function(event) {\n\n                  if (!event) {\n                    event = window.event;\n                  }\n\n                  // Prevent the default action - this is so <a href=\"#step1\">\n                  // can act as a navigation element but the anchor link will\n                  // only activate when JS is disabled\n                  if (event.preventDefault) {\n                    event.preventDefault();\n                  } else {\n                    event.returnValue = false;\n                  }\n\n                  callback();\n                });\n              };\n              break;\n\n            // Set up a click event for pagination\n            case \"pagination\":\n\n              buttonEvent = function(element, rel) {\n\n                handler = addEvent(element, \"click\", function(event, element) {\n\n                  if (!event) {\n                    event = window.event;\n                  }\n\n                  // Prevent the default action - this is so <a href=\"#step1\">\n                  // can act as a pagination element but the anchor link will\n                  // only activate when JS is disabled\n                  if (event.preventDefault) {\n                    event.preventDefault();\n                  } else {\n                    event.returnValue = false;\n                  }\n\n                  var targetElement = event.target || event.srcElement;\n\n                  parent = this;\n\n                  // Get the ID of the clicked pagination link\n                  id = hasParent(parent, targetElement);\n\n                  // Go to the clicked pagination ID\n                  self.goTo(id);\n                });\n\n                // Save the pagination links\n                self.$pagination.links.push(self.pagination.getLinks(element, rel));\n              };\n              break;\n          }\n\n          // Add a click event for each element\n          for (i = 0; i < elementsLength; i++) {\n            element = elements[i];\n\n            // Does the button control a specific Sequence instance?\n            rel = element.getAttribute(\"rel\");\n\n            // The button controls one Sequence instance\n            // (defined via the rel attribute)\n            if (rel === self.$container.id && element.getAttribute(\"data-seq-button\") === null) {\n\n              element.setAttribute(\"data-seq-button\", true);\n              buttonEvent(element, rel);\n            }\n\n            // The button controls all Sequence instances\n            else if (rel === null && element.getAttribute(\"data-seq-button\") === null) {\n\n              buttonEvent(element, rel);\n            }\n\n            // Save the element and its handler for later, should it need to\n            // be removed\n            self.manageEvents.list.click.push({\"element\": element, \"handler\": handler});\n          }\n\n          return self.manageEvents.list.click;\n        },\n\n        /**\n         * Stop and start autoPlay when the user's cursor enters and leaves\n         * the Sequence element accordingly.\n         *\n         * Note: autoPlay will be stopped only when the cursor is inside the\n         * boundaries of the Sequence element, either on the element itself or\n         * its children. Child elements overflowing the Sequence element will\n         * not cause Sequence to be stopped.\n         */\n        stopOnHover: function() {\n\n          var previouslyInside = false,\n              touchHandler,\n              handler;\n\n          self.isMouseOver = false;\n\n          /**\n           * Determine when the user touches the container. This is so we can\n           * disable the use of stopOnHover for touches, but not for mousemove\n           */\n          touchHandler = addEvent(self.$container, \"touchstart\", function(e) {\n\n            self.isTouched = true;\n          });\n\n          // Save the event\n          self.manageEvents.list.touchstart.push({\"element\": self.$container, \"handler\": touchHandler});\n\n          /**\n           * Stop autoPlay only when the cursor is inside the boundaries of the\n           * Sequence element\n           */\n          handler = addEvent(self.$container, \"mousemove\", function(e) {\n\n            e = e || window.event;\n\n            // If the user touched the container, don't stop - stopOnHover\n            // should only occur when a mouse cursor is used\n            if (self.isTouched === true) {\n              self.isTouched = false;\n              return;\n            }\n\n            // Is the cursor inside the Sequence element?\n            if (insideElement(self.$container, e) === true) {\n\n              // Pause if the cursor was previously outside the Sequence element\n              if (self.options.autoPlayPauseOnHover === true && self.isMouseOver === false) {\n                self.autoPlay.pause();\n              }\n\n              // We're now inside the Sequence element\n              self.isMouseOver = true;\n            }\n\n            // The cursor is outside of the main container, but over child\n            // elements belonging to the container\n            else {\n\n              // Unpause if the cursor was previously inside the Sequence element\n              if (self.options.autoPlayPauseOnHover === true && self.isMouseOver === true) {\n                self.autoPlay.unpause();\n              }\n\n              // We're now outside the Sequence element\n              self.isMouseOver = false;\n            }\n          });\n\n          // Save the event\n          self.manageEvents.list.mousemove.push({\"element\": self.$container, \"handler\": handler});\n\n          /**\n           * Start autoPlay when the cursor leaves the Sequence element\n           */\n          handler = addEvent(self.$container, \"mouseleave\", function(e) {\n\n            if (self.options.autoPlayPauseOnHover === true) {\n              self.autoPlay.unpause();\n            }\n\n            // We're now outside the Sequence element\n            self.isMouseOver = false;\n          });\n\n          // Save the event\n          self.manageEvents.list.mouseleave.push({\"element\": self.$container, \"handler\": handler});\n\n          return null;\n        },\n\n        /**\n         * Navigate to a step when Sequence is swiped\n         */\n        swipeNavigation: function() {\n\n          // Don't use swipe navigation if the browser doesn't support\n          // addEventListener (Hammer.js needs it)\n          if (window.addEventListener === undefined) {\n            self.hammerTime = false;\n            return;\n          }\n\n          var hammerDirection,\n              handler;\n\n          if (typeof Hammer === \"function\") {\n\n            handler = function(e) {\n\n              switch(e.direction) {\n\n                // Left\n                case 2:\n                  self.options.swipeEvents.left(self);\n                break;\n\n                // Right\n                case 4:\n                  self.options.swipeEvents.right(self);\n                break;\n\n                // Up\n                case 8:\n                  self.options.swipeEvents.up(self);\n                break;\n\n                // Down\n                case 16:\n                  self.options.swipeEvents.down(self);\n                break;\n              }\n            };\n\n            // Set up the swipe event\n            self.hammerTime = new Hammer(self.$container).on(\"swipe\", handler);\n\n            // Set Hammer's Swipe options\n            self.hammerTime.get(\"swipe\").set(self.options.swipeHammerOptions);\n\n            // determine the Hammer direction that needs to be set based on the\n            // swipe directions being used (hammerjs.github.io/api/#directions)\n            hammerDirection = getHammerDirection(self.options.swipeEvents);\n            self.hammerTime.get(\"swipe\").set({direction: hammerDirection});\n\n            self.manageEvents.list.hammer.push({\"element\": self.$container, \"handler\": handler});\n          }\n        },\n\n        /**\n         * Navigate to a step when corresponding keys are pressed\n         */\n        keyNavigation: function() {\n\n          var handler = addEvent(document, \"keyup\", function(event) {\n\n            if (!event) {\n              event = window.event;\n            }\n\n            // Get the key pressed\n            var keyCodeChar = parseInt(String.fromCharCode(event.keyCode));\n\n            // Go to the numeric key pressed\n            if ((keyCodeChar > 0 && keyCodeChar <= self.noOfSteps) && (self.options.numericKeysGoToSteps)) {\n              self.goTo(keyCodeChar);\n            }\n\n            // When left/right arrow keys are pressed, go to prev/next steps\n            switch(event.keyCode) {\n              case 37:\n                self.options.keyEvents.left(self);\n              break;\n\n              case 39:\n                self.options.keyEvents.right(self);\n              break;\n            }\n          });\n\n          self.manageEvents.list.keyup.push({\"element\": document, \"handler\": handler});\n        },\n\n        /**\n         * Throttle the window resize event so it only occurs every x amount of\n         * milliseconds, as defined by the resizeThreshold global variable.\n         */\n        resizeThrottle: function() {\n\n          // Events to be executed when the throttled window resize occurs\n          function throttledEvents() {\n\n            // Use a delay to give the browser a chance to repaint before\n            // getting transform properties\n            setTimeout(function() {\n              self.canvas.getTransformProperties();\n\n              /**\n               * Snap to the currently active step\n               *\n               * Assume the canvas is laid out in a 2 x 2 grid, the Sequence\n               * element has a height of 100%, and the user is viewing the second\n               * row of steps -- when the user resizes the window, the second row\n               * of steps will no longer be positioned perfectly in the window.\n               * This event will immediately snap the canvas back into place.\n               */\n              if (self.propertySupport.transitions === true) {\n                self.canvas.move(self.currentStepId, false);\n              }\n            }, 500);\n\n            // Callback\n            self.throttledResize(self);\n          }\n\n          /**\n           * Throttle the resize event to only execute throttledEvents() every\n           * 100ms. This is so not too many events occur during a resize. The\n           * threshold can be changed using the resizeThreshold global variable.\n           */\n          var throttleTimer,\n              handler;\n\n          handler = addEvent(window, \"resize\", function(e) {\n\n            clearTimeout(throttleTimer);\n            throttleTimer = setTimeout(throttledEvents, resizeThreshold);\n          });\n\n          self.manageEvents.list.resize.push({\"element\": window, \"handler\": handler});\n        },\n\n        /**\n         * When the page loses visibility, pause autoPlay, then unpause when\n         * the page gains visibility again\n         */\n        pageVisibility: function() {\n\n          var handler = addEvent(document, visibilityChange, function() {\n\n            if (document[hidden]) {\n\n              self.autoPlay.pause();\n            } else {\n\n              self.autoPlay.unpause();\n            }\n          }, false);\n\n          self.manageEvents.list[visibilityChange].push({\"element\": document, \"handler\": handler});\n        }\n      }\n    };\n\n    /**\n     * Set up an instance of Sequence\n     *\n     * @param {Object} element - The element Sequence is attached to\n     */\n    self.init = function(element) {\n\n      var id,\n          prevStep,\n          prevStepId,\n          transformProperties,\n          goToFirstStep;\n\n      // Merge developer options with defaults\n      self.options = extend(defaults, options);\n\n      self.isAnimating = false;\n      self.isReady = false;\n\n      // Get the element Sequence is attached to, the screen,\n      // the canvas and it's steps\n      self.$container = element;\n      self.$screen = self.$container.querySelectorAll(\".seq-screen\")[0];\n      self.$canvas = self.$container.querySelectorAll(\".seq-canvas\")[0];\n      self.$steps = self.canvas.getSteps(self.$canvas);\n\n      // Count number of steps\n      self.noOfSteps = self.$steps.length;\n\n      self.phasesAnimating = 0;\n      self.phasesSkipped = [];\n\n      // Add classes to the Sequence container that represent features supported\n      addFeatureSupportClasses(self.$container, Modernizr);\n\n      // Get the first step's ID\n      id = self.options.startingStepId;\n\n      addClass(self.$container, \"seq-active\");\n\n      // Find out what properties the browser supports\n      // and whether Sequence should go into fallback mode\n      self.propertySupport = self.animation.getPropertySupport();\n      self.isFallbackMode = self.animation.requiresFallbackMode(self.propertySupport);\n\n      // Set up the canvas and screen with the necessary CSS properties\n      self.canvas.init(id);\n\n      // Remove the no-JS \"seq-in\" class from a step\n      self.canvas.removeNoJsClass(self);\n\n      // Set up events\n      self.manageEvents.init();\n\n      // Set up autoPlay\n      self.autoPlay.init();\n\n      // On the first run, we need to treat the animation a little differently\n      self.firstRun = true;\n\n      // Set up hashTag support if being used and override the first ID if there\n      // is a hashTag in the entering URL that has a corresponding step\n      id = self.hashTags.init(id);\n\n      // Get the previous step ID\n      if (self.options.autoPlayDirection === 1) {\n        prevStepId = id - 1;\n        self.prevStepId = (prevStepId < 1) ? self.noOfSteps: prevStepId;\n      } else {\n        prevStepId = id + 1;\n        self.prevStepId = (prevStepId > self.noOfSteps) ? 1: prevStepId;\n      }\n\n      // Get the previous step and next step\n      self.currentStepId = self.prevStepId;\n      prevStep = self.prevStepId;\n\n      // If the browser doesn't support CSS transitions, setup the fallback\n      self.animationFallback.setupCanvas(id);\n\n      goToFirstStep = function() {\n\n        self.animation.domDelay(function() {\n\n          // Snap the previous step into position\n          self.animation.domDelay(function() {\n            self.animation.resetInheritedSpeed(prevStep);\n          });\n\n          self.isReady = true;\n\n          // Callback\n          self.ready(self);\n\n          // Go to the first step\n          self.goTo(id, self.options.autoPlayDirection, true);\n        });\n      };\n\n      // Set up preloading if required, then go to the first step\n      if (self.options.preloader !== false && document.querySelectorAll !== undefined && typeof imagesLoaded === \"function\") {\n\n        self.preload.init(function() {\n          goToFirstStep();\n        });\n      } else {\n        goToFirstStep();\n      }\n    };\n\n    /**\n     * Destroy an instance of Sequence\n     *\n     * @returns {Boolean}\n     */\n    self.destroy = function() {\n\n      var i,\n          step,\n          lastStep;\n\n      // Stop autoPlay\n      self.autoPlay.stop();\n\n      // Stop timers\n      clearTimeout(self.autoPlayTimer);\n      clearTimeout(self.phaseThresholdTimer);\n      clearTimeout(self.stepEndedTimer);\n      clearTimeout(self.currentPhaseEndedTimer);\n      clearTimeout(self.nextPhaseStartedTimer);\n      clearTimeout(self.nextPhaseEndedTimer);\n      clearTimeout(self.fadeStepTimer);\n      clearTimeout(self.hideTimer);\n      clearTimeout(self.navigationSkipThresholdTimer);\n\n      // Remove all events\n      self.manageEvents.removeAll(self.manageEvents.list);\n\n      // Remove classes\n      removeClass(self.$pagination.currentLinks, \"seq-current\");\n      removeClass(self.$container, \"seq-step\" + self.currentStepId);\n      removeClass(self.$container, \"seq-active\");\n\n      // Remove styles\n      self.$container.removeAttribute(\"style\");\n      if (self.$screen !== undefined) {\n        self.$screen.removeAttribute(\"style\");\n      }\n      self.$canvas.removeAttribute(\"style\");\n\n      // Remove styles from steps and snap them to their \"seq-out\" position\n      for (i = 0; i < self.noOfSteps; i++) {\n        step = self.$steps[i];\n\n        step.removeAttribute(\"style\");\n        self.animation.resetInheritedSpeed(i + 1);\n        removeClass(step, \"seq-in\");\n        removeClass(step, \"seq-out\");\n      }\n\n      // Snap the starting step back into its \"seq-in\" position\n      lastStep = self.$steps[self.options.startingStepId - 1];\n      self.animation.resetInheritedSpeed(self.options.startingStepId);\n      addClass(lastStep, \"seq-in\");\n\n      // Allow the same element to have Sequence initated on it in the future\n      element.removeAttribute(\"data-seq-enabled\");\n\n      // Callback\n      self.destroyed(self);\n\n      // Finally, clear the instance's properties and methods\n      self = null;\n\n      return self;\n    };\n\n    /**\n     * Go to the next step\n     *\n     * @returns {Number | false} The ID of the next step Sequence will\n     * navigate to or false if next() is prevented because the current step is\n     * the last and the cycle option is disabled\n     */\n    self.next = function() {\n\n      var nextStepId = self.currentStepId + 1;\n\n      // Cycle to the first step if on the current step and cycle is enabled\n      if (nextStepId > self.noOfSteps && self.options.cycle === false) {\n        return false;\n      } else if (nextStepId > self.noOfSteps) {\n        nextStepId = 1;\n      }\n\n      self.goTo(nextStepId);\n\n      return nextStepId;\n    };\n\n    /**\n     * Go to the previous step\n     *\n     * @returns {Number | false} The ID of the previous step Sequence will\n     * navigate to or false if prev() is prevented because the current step is\n     * the first and the cycle option is disabled\n     */\n    self.prev = function() {\n\n      var prevStepId = self.currentStepId - 1,\n          direction;\n\n      if (prevStepId < 1 && self.options.cycle === false) {\n        return false;\n      } else if (prevStepId < 1) {\n        prevStepId = self.noOfSteps;\n      }\n\n      if (self.options.reverseWhenNavigatingBackwards === true) {\n        direction = -1;\n      }\n\n      self.goTo(prevStepId, direction);\n\n      return prevStepId;\n    };\n\n    /**\n     * Stop and start Sequence's autoPlay feature\n     *\n     * @param {Boolean/Number} delay - Whether a delay should be applied before\n     * starting autoPlay (true = same amount as options.autoPlayInterval,\n     * false = no delay, number = custom delay period). Applied to\n     * autoPlay.start()\n     * @returns {Boolean} isAutoPlaying - true if autoPlay was started, false if stopped\n     */\n    self.toggleAutoPlay = function(delay) {\n\n      if (self.isAutoPlaying === false) {\n        self.start(delay);\n      } else {\n        self.stop();\n      }\n\n      return self.isAutoPlaying;\n    };\n\n    self.stop = function() {\n\n      self.autoPlay.stop();\n    };\n\n    self.start = function(delay) {\n\n      self.autoPlay.start(delay);\n    };\n\n    /**\n     * Go to a specific step\n     *\n     * @param {Number} id - The ID of the step to go to\n     * @param {Number} direction - Direction to get to the step\n     * (1 = forward, -1 = reverse)\n     * @param {Boolean} ignorePhaseThreshold - if true, ignore the\n     * transitionThreshold setting and immediately go to the specified step\n     * @param {Boolean} hashTagNav - If navigation is triggered by the hashTag\n     * @returns {Boolean} false when goTo was disallowed true when allowed\n     */\n    self.goTo = function(id, direction, ignorePhaseThreshold, hashTagNav) {\n\n      // Get the direction to navigate if one wasn't specified\n      direction = self.animation.getDirection(id, direction, self.currentStepId, self.noOfSteps, self.isFallbackMode, self.options.reverseWhenNavigatingBackwards, self.options.cycle);\n\n      /**\n       * Don't go to a step if:\n       *\n       * - ID isn't defined\n       * - It doesn't exist\n       * - It is already animating\n       * - navigationSkip isn't allowed and an animation is active\n       * - navigationSkip is allowed but the threshold is yet to expire (unless\n       *   navigating via forward/back button with hashTags enabled - see\n       *   manageEvents.add.hashChange() for an explanation of this)\n       * - transitions aren't supported and Sequence is active (navigation\n       *   skipping isn't allowed in fallback mode, unless navigating via\n       *   forward/back buttons)\n       * - preventReverseSkipping is enabled and the user is trying to navigate\n       *   in a different direction to the one already active\n       */\n      if (id === undefined || id < 1 || id > self.noOfSteps || id === self.currentStepId || (self.options.navigationSkip === false && self.isAnimating === true) || (self.options.navigationSkip === true && self.navigationSkipThresholdActive === true && hashTagNav === undefined) || (self.isFallbackMode === true && self.isAnimating === true && hashTagNav === undefined) || (self.options.preventReverseSkipping === true && self.direction !== direction && self.isAnimating === true)) {\n        return false;\n      }\n\n      var currentStepElement,\n          nextStepElement;\n\n      // Clear the previous autoPlayTimer\n      clearTimeout(self.autoPlayTimer);\n\n      // Save the latest direction\n      self.direction = direction;\n\n      // Add the \"seq-reversed\" class if navigating in reverse\n      if (direction === 1) {\n        // Add a \"seq-reversed\" class\n        removeClass(self.$container, \"seq-reversed\");\n      } else {\n        // Add a \"seq-reversed\" class\n        addClass(self.$container, \"seq-reversed\");\n      }\n\n      // Get the current and next step elements\n      currentStepElement = self.$steps[self.currentStepId - 1];\n      nextStepElement = self.$steps[id - 1];\n\n      // Move the active step to the top (via a higher z-index)\n      self.animation.moveActiveStepToTop(currentStepElement, nextStepElement);\n\n      // Change the step number on the Sequence element\n      self.animation.changeStep(id);\n\n      if (self.isFallbackMode === false) {\n\n        // Reset the next step's elements durations to 0ms so it can be snapped\n        // into place\n        self.animation.resetInheritedSpeed(id);\n\n        if (self.firstRun === false || (self.firstRun === true && self.options.startingStepAnimatesIn === true)) {\n\n          // Callback\n          self.animationStarted(id, self);\n        }\n\n        // Animate the canvas\n        self.canvas.move(id, true);\n\n        // Determine how often goTo() can be used based on\n        // navigationSkipThreshold and manage step fading accordingly\n        self.animation.manageNavigationSkip(id, nextStepElement);\n\n        // Are we moving the active phases forward or in reverse?\n        if (direction === 1) {\n\n          self.animation.forward(id, currentStepElement, nextStepElement, ignorePhaseThreshold, hashTagNav);\n        } else {\n          self.animation.reverse(id, currentStepElement, nextStepElement, ignorePhaseThreshold, hashTagNav);\n        }\n      }\n\n      // Use fallback animation\n      else {\n\n        self.animationFallback.goTo(id, self.currentStepId, currentStepElement, id, nextStepElement, direction, hashTagNav);\n      }\n\n      return true;\n    };\n\n    /* --- CALLBACKS --- */\n\n    /**\n     * Callback executed when autoPlay is started\n     */\n    self.started = function(self) {\n\n      // console.log(\"auto play started\");\n    };\n\n    /**\n     * Callback executed when autoPlay is stopped\n     */\n    self.stopped = function(self) {\n\n      // console.log(\"auto play stopped\");\n    };\n\n    /**\n     * Callback executed when a step animation starts\n     *\n     * @param {Number} id - The ID of the step that was started\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.animationStarted = function(id, self) {\n\n      // console.log(\"Animation started\", id);\n    };\n\n    /**\n     * Callback executed when a step animation finishes\n     *\n     * @param {Number} id - The ID of the step that finished\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.animationEnded = function(id, self) {\n\n      // console.log(\"Animation ended\", id);\n    };\n\n    /**\n     * Callback executed when the current phase starts animating\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.currentPhaseStarted = function(id, self) {\n\n      // console.log(\"Current phase started\", id);\n    };\n\n    /**\n     * Callback executed when the current phase finishes animating\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.currentPhaseEnded = function(id, self) {\n\n      // console.log(\"Current phase ended\", id);\n    };\n\n    /**\n     * Callback executed when the next phase starts animating\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.nextPhaseStarted = function(id, self) {\n\n      // console.log(\"Next phase started\", id);\n    };\n\n    /**\n     * Callback executed when the next phase finishes animating\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.nextPhaseEnded = function(id, self) {\n\n      // console.log(\"Next phase ended\", id);\n    };\n\n    /**\n     * When the throttled window resize event occurs\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.throttledResize = function(self) {\n\n\n    };\n\n    /**\n     * Callback executed when preloading has finished\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.preloaded = function(self) {\n\n      // console.log(\"preloaded\");\n    };\n\n    /**\n     * Callback executed every time an image to be preloaded returns a status\n     *\n     * @param {String} result - Whether the image is \"loaded\" or \"broken\"\n     * @param {String} src - The source of the image\n     * @param {Number} progress - The number of images that have returned a result\n     * @param {Number} length - The total number of images that are being preloaded\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.preloadProgress = function(result, src, progress, length, self) {\n\n      // console.log(progress, length);\n    };\n\n    /**\n     * Callback executed when Sequence is ready to be interacted with\n     * = preloading + domDelay\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.ready = function(self) {\n\n      // console.log(\"Ready\");\n    };\n\n    /**\n     * Callback executed when Sequence has finished being destroyed via .destroy()\n     *\n     * @param {Object} self - Properties and methods available to this instance\n     */\n    self.destroyed = function(self) {\n\n      // console.log(\"Destroyed\");\n    };\n\n    /**\n    * Make some of Sequence's helper functions public\n    *\n    * addClass() / removeClass() etc can be useful for custom theme code\n    */\n    self.utils = {\n      addClass: addClass,\n      removeClass: removeClass,\n      addEvent: addEvent,\n      removeEvent: removeEvent\n    };\n\n\n    /* --- INIT --- */\n    self.init(element);\n\n    // Save the instance globally so we can return it if an init is tried again\n    instances.push(self);\n\n    return self;\n  });\n\n  return Sequence;\n}\n\nif (typeof define === \"function\" && define.amd) {\n\n  define([\"imagesLoaded\", \"Hammer\"], defineSequence);\n} else {\n\n  /* Make dependencies optional */\n  Hammer = (typeof Hammer !== \"function\") ? null: Hammer;\n  imagesLoaded = (typeof imagesLoaded !== \"function\") ? null: imagesLoaded;\n\n  var sequence = defineSequence(imagesLoaded, Hammer);\n}\n"]}